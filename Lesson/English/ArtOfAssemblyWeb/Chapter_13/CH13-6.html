<html>
<!-- Generated by Harlequin WebMaker 2.2.6 (30-Apr-1996)Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->


<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_13/CH13-6.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="pragma" content="no-cache">
<title>CHAPTER THIRTEEN: MS-DOS, PC-BIOS AND FILE I/O (Part 6)</title>
</head>

<body topmargin="10" stylesrc="../toc.html" bgcolor="#FFFFFF" text="#000000" link="#008000" vlink="#000000">
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" colspan="3"><p align="right"><a name="top"></a><font size="1" face="Arial">The Art of<br>
    </font><font face="Arial Black" size="1">ASSEMBLY LANGUAGE PROGRAMMING</font></td>
  </tr>
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"><a NAME="HEADING6"></a></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH13-5.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH13-5.html">Chapter Thirteen</a> (Part 5)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH13-7.html">Chapter Thirteen</a> (Part 7)&nbsp; </strong></font><a href="CH13-7.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" bgcolor="#FFFFFF" nowrap height="10" colspan="2"><a NAME="HEADING6-1"></a></td>
  </tr>
  <tr>
    <td width="100%" bgcolor="#F0F0F0" colspan="2"><font face="Arial" size="4"><strong>CHAPTER
    THIRTEEN:<br>
    MS-DOS, PC-BIOS AND FILE I/O (Part 6)</strong></font></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="10" colspan="2"></td>
  </tr>
  <tr>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING6-1"><b>13.3.8 </b>-
    MS-DOS &quot;New&quot; Filing Calls</a> <br>
    <a HREF="#HEADING6-14"><b>13.3.8.1 </b>- Open File</a> <br>
    <a HREF="#HEADING6-42"><b>13.3.8.2 </b>- Create File</a> <br>
    <a HREF="#HEADING6-67"><b>13.3.8.3 </b>- Close File</a> <br>
    <a HREF="#HEADING6-79"><b>13.3.8.4 </b>- Read From a File</a> <br>
    <a HREF="#HEADING6-121"><b>13.3.8.5 </b>- Write to a File</a> <br>
    <a HREF="#HEADING6-137"><b>13.3.8.6 </b>- Seek (Move File Pointer)</a> <br>
    <a HREF="#HEADING6-169"><b>13.3.8.7 </b>- Set Disk Transfer Address (DTA)</a> </font></td>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING6-176"><b>13.3.8.8
    </b>- Find First File</a> <br>
    <a HREF="#HEADING6-201"><b>13.3.8.9 </b>- Find Next File</a> <br>
    <a HREF="#HEADING6-232"><b>13.3.8.10 </b>- Delete File</a> <br>
    <a HREF="#HEADING6-243"><b>13.3.8.11 </b>- Rename File</a> <br>
    <a HREF="#HEADING6-286"><b>13.3.8.12 </b>- Change/Get File Attributes</a> <br>
    <a HREF="#HEADING6-304"><b>13.3.8.13 </b>- Get/Set File Date and Time</a> <br>
    <a HREF="#HEADING6-321"><b>13.3.8.14 </b>- Other DOS Calls</a> </font></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="20" colspan="2"></td>
  </tr>
</table>
</center></div>

<h3><strong><font face="Arial" size="3">13.3.8 MS-DOS &quot;New&quot; Filing Calls</font></strong></h3>

<p><font face="Arial" size="2">Starting with DOS v2.0, Microsoft introduced a set of file
handling procedures which (finally) made disk file access bearable under MS-DOS. Not only
bearable, but actually easy to use! The following sections describe the use of these
commands to access files on a disk drive. </font></p>

<p><font face="Arial" size="2">File commands which deal with filenames (Create, Open,
Delete, Rename, and others) are passed the address of a zero-terminated pathname. Those
that actually open a file (Create and Open) return a file handle as the result (assuming,
of course, that there wasn't an error). This file handle is used with other calls (read,
write, seek, close, etc.) to gain access to the file you've opened. In this respect, a
file handle is not unlike a file variable in Pascal. Consider the following
Microsoft/Turbo Pascal code: </font></p>

<pre><font face="Courier New" size="2">        program DemoFiles; var  F:TEXT;
        begin
                assign(f,'FileName.TXT');
                rewrite(f);
                writeln(f,'Hello there');
                close(f);
        end. </font></pre>

<p><font face="Arial" size="2">The file variable &quot;f&quot; is used in this Pascal
example in much the same way that a file handle is used in an assembly language program -
to gain access to the file that was created in the program. </font></p>

<p><font face="Arial" size="2">All the following DOS filing commands return an error
status in the carry flag. If the carry flag is clear when DOS returns to your program,
then the operation was completed successfully. If the carry flag is set upon return, then
some sort of error has occurred and the AX register contains the error number. The actual
error return values will be discussed along with each function in the following sections.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-14"></a>13.3.8.1 Open File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  3Dh
Entry parameters:
                al- file access value
                        0- File opened for reading 
                        1- File opened for writing
                        2- File opened for reading and writing
                ds:dx- Point at a zero terminated string containing the filename.
Exit parameters:        
                If the carry is set, ax contains one of the following error codes:
                        2- File not found 
                        4- Too many open files
                        5- Access denied 
                        12- Invalid access
        
                If the carry is clear, 
                        ax contains the file handle value assigned by DOS.</font></pre>

<p><font face="Arial" size="2">A file must be opened before you can access it. The open
command opens a file that already exists. This makes it quite similar to Pascal's Reset
procedure. Attempting to open a file that doesn't exist produces an error. Example:</font></p>

<pre><font face="Courier New" size="2">                lea     dx, Filename    ;Assume DS points at segment
                mov     ah, 3dh         ; of filename
                mov     al, 0           ;Open for reading.
                int     21h
                jc      OpenError
                mov     FileHandle, ax</font></pre>

<p><font face="Arial" size="2">If an error occurs while opening a file, the file will not
be opened. You should always check for an error after executing a DOS open command, since
continuing to operate on the file which hasn't been properly opened will produce
disastrous consequences. Exactly how you handle an open error is up to you, but at the
very least you should print an error message and give the user the opportunity to specify
a different filename. </font></p>

<p><font face="Arial" size="2">If the open command completes without generating an error,
DOS returns a file handle for that file in the <code>ax </code>register. Typically, you
should save this value away somewhere so you can use it when accessing the file later on.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-42"></a>13.3.8.2 Create File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  3Ch
Entry parameters:
                ds:dx- Address of zero terminated pathname
                cx- File attribute
Exit parameters:
                If the carry is set, ax contains one of the following error codes:
                 3- Path not found      
                 4- Too many open files
                 5- Access denied
                If the carry is clear, 
                 ax is returned containing the file handle</font></pre>

<p><font face="Arial" size="2">Create opens a new file for output. As with the OPEN
command, <code>ds:dx </code>points at a zero terminated string containing the filename.
Since this call creates a new file, DOS assumes that you're opening the file for writing
only. Another parameter, passed in <code>cx</code>, is the initial file attribute
settings. The L.O. six bits of <code>cx </code>contain the following values: </font></p>

<pre><font face="Courier New" size="2">Bit     Meaning if equal to one 
0       File is a Read-Only file
1       File is a hidden file 
2       File is a system file
3       File is a volume label name
4       File is a subdirectory
5       File has been archived</font></pre>

<p><font face="Arial" size="2">In general, you shouldn't set any of these bits. Most
normal files should be created with a file attribute of zero. Therefore, the <code>cx </code>register
should be loaded with zero before calling the create function. </font></p>

<p><font face="Arial" size="2">Upon exit, the carry flag is set if an error occurs. The
&quot;Path not found&quot; error requires some additional explanation. This error is
generated, not if the file isn't found (which would be most of the time since this command
is typically used to create a new file), but if a subdirectory in the pathname cannot be
found. </font></p>

<p><font face="Arial" size="2">If the carry flag is clear when DOS returns to your
program, then the file has been properly opened for output and the <code>ax </code>register
contains the file handle for this file.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-67"></a>13.3.8.3 Close File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  3Eh
Entry parameters:       
                bx- File Handle
Exit parameters:        
                If the carry flag is set, 
                 ax contains 6, the only possible error, 
                 which is an invalid handle error.</font></pre>

<p><font face="Arial" size="2">This call is used to close a file opened with the Open or
Create commands above. It is passed the file handle in the <code>bx </code>register and,
assuming the file handle is valid, closes the specified file. </font></p>

<p><font face="Arial" size="2">You should close all files your program uses as soon as
you're through with them to avoid disk file corruption in the event the user powers the
system down or resets the machine while your files are left open. </font></p>

<p><font face="Arial" size="2">Note that quitting to DOS (or aborting to DOS by pressing
control-C or control-break) automatically closes all open files. However, you should never
rely on this feature since doing so is an extremely poor programming practice.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-79"></a>13.3.8.4 Read From a File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):    3Fh
Entry parameters:
                  bx- File handle 
                  cx- Number of bytes to read
                  ds:dx- Array large enough to hold bytes read
Exit parameters:        
                  If the carry flag is set, 
                  ax contains one of the following error codes
                  5- Access denied
                  6- Invalid handle
                  If the carry flag is clear, 
                  ax contains the number of bytes actually read from the file.</font></pre>

<p><font face="Arial" size="2">The read function is used to read some number of bytes from
a file. The actual number of bytes is specified by the <code>cx </code>register upon entry
into DOS. The file handle, which specifies the file from which the bytes are to be read,
is passed in the <code>bx </code>register. The <code>ds:dx </code>register contains the
address of a buffer into which the bytes read from the file are to be stored. </font></p>

<p><font face="Arial" size="2">On return, if there wasn't an error, the <code>ax </code>register
contains the number of bytes actually read. Unless the end of file (EOF) was reached, this
number will match the value passed to DOS in the <code>cx </code>register. If the end of
file has been reached, the value return in <code>ax </code>will be somewhere between zero
and the value passed to DOS in the <code>cx </code>register. This is the only test for the
EOF condition. </font></p>

<p><font face="Arial" size="2">Example: This example opens a file and reads it to the EOF</font></p>

<pre><font face="Courier New" size="2">                mov     ah, 3dh         ;Open the file
                mov     al, 0           ;Open for reading
                lea     dx, Filename    ;Presume DS points at filename
                int     21h             ; segment.
                jc      BadOpen
                mov     FHndl, ax       ;Save file handle

LP:             mov     ah,3fh          ;Read data from the file
                lea     dx, Buffer      ;Address of data buffer
                mov     cx, 1           ;Read one byte
                mov     bx, FHndl       ;Get file handle value
                int     21h
                jc      ReadError
                cmp     ax, cx          ;EOF reached?
                jne     EOF
                mov     al, Buffer      ;Get character read
                putc                    ;Print it
                jmp     LP              ;Read next byte

EOF:            mov     bx, FHndl
                mov     ah, 3eh         ;Close file
                int     21h
                jc      CloseError</font></pre>

<p><font face="Arial" size="2">This code segment will read the entire file whose
(zero-terminated) filename is found at address &quot;Filename&quot; in the current data
segment and write each character in the file to the standard output device using the UCR
StdLib <code>putc</code> routine. Be forewarned that one-character-at-a-time I/O such as
this is extremely slow. We'll discuss better ways to quickly read a file a little later in
this chapter.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-121"></a>13.3.8.5 Write to a File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):    40h
Entry parameters:       
                  bx- File handle
                  cx- Number of bytes to write
                  ds:dx- Address of buffer containing data to write
Exit parameters:        
                  If the carry is set, 
                  ax contains one of the following error codes
                  5- Accessed denied 
                  6- Invalid handle
                  If the carry is clear on return, 
                  ax contains the number of bytes actually written to the file. </font></pre>

<p><font face="Arial" size="2">This call is almost the converse of the read command
presented earlier. It writes the specified number of bytes at <code>ds:dx </code>to the
file rather than reading them. On return, if the number of bytes written to the file is
not equal to the number originally specified in the <code>cx </code>register, the disk is
full and this should be treated as an error. </font></p>

<p><font face="Arial" size="2">If <code>cx </code>contains zero when this function is
called, DOS will truncate the file to the current file position (i.e., all data following
the current position in the file will be deleted).</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-137"></a>3.3.8.6 Seek (Move File
Pointer)</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  42h Entry parameters:
                al- Method of moving
                 0- Offset specified is from the beginning of the file. 
                 1- Offset specified is distance from the current file pointer.
                 2- The pointer is moved to the end of the file minus the specified offset.
                bx- File handle. 
                cx:dx- Distance to move, in bytes.
Exit parameters:        
                If the carry is set, 
                 ax contains one of the following error codes
                  1- Invalid function 
                  6- Invalid handle
                If the carry is clear, 
                 dx:ax contains the new file position</font></pre>

<p><font face="Arial" size="2">This command is used to move the file pointer around in a
random access file. There are three methods of moving the file pointer, an absolute
distance within the file (if <code>al</code>=0), some positive distance from the current
file position (if <code>al</code>=1), or some distance from the end of the file (if <code>al</code>=2).
If AL doesn't contain 0, 1, or 2, DOS will return an invalid function error. If this call
is successfully completed, the next byte read or written will occur at the specified
location. </font></p>

<p><font face="Arial" size="2">Note that DOS treats <code>cx:dx </code>as an unsigned
integer. Therefore, a single seek command cannot be used to move backwards in the file.
Instead, method #0 must be used to position the file pointer at some absolute position in
the file. If you don't know where you currently are and you want to move back 256 bytes,
you can use the following code:</font></p>

<pre><font face="Courier New" size="2">                mov     ah, 42h         ;Seek command
                mov     al, 1           ;Move from current location
                xor     cx, cx          ;Zero out CX and DX so we
                xor     dx, dx          ; stay right here
                mov     bx, FileHandle
                int     21h
                jc      SeekError
                sub     ax, 256         ;DX:AX now contains the
                sbb     dx, 0           ; current file position, so
                mov     cx, dx          ; compute a location 256 
                mov     dx, ax          ; bytes back.
                mov     ah, 42h
                mov     al, 0           ;Absolute file position
                int     21h             ;BX still contains handle.</font></pre>

<pre><strong><font face="Arial" size="3">13.3.8.7 Set Disk Transfer Address (DTA)</font></strong></pre>

<pre><font face="Courier New" size="2">Function (ah):  1Ah Entry parameters:
                ds:dx- Pointer to DTA
Exit parameters:        
                None</font></pre>

<p><font face="Arial" size="2">This command is called &quot;Set Disk Transfer
Address&quot; because it was (is) used with the original DOS v1.0 file functions. We
wouldn't normally consider this function except for the fact that it is also used by
functions 4Eh and 4Fh (described next) to set up a pointer to a 43-byte buffer area. If
this function isn't executed before executing functions 4Eh or 4Fh, DOS will use the
default buffer space at PSP:80h.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-176"></a>13.3.8.8 Find First File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):    4Eh
Entry parameters:       
                  cx- Attributes 
                  ds:dx- Pointer to filename
Exit parameters:        
                  If carry is set, 
                  ax contains one of the following error codes
                   2- File not found 
                  18- No more files </font></pre>

<p><font face="Arial" size="2">The Find First File and Find Next File (described next)
functions are used to search for files specified using ambiguous file references. An
ambiguous file reference is any filename containing the &quot;*&quot; and &quot;?&quot;
wildcard characters. The Find First File function is used to locate the first such
filename within a specified directory, the Find Next File function is used to find
successive entries in the directory. </font></p>

<p><font face="Arial" size="2">Generally, when an ambiguous file reference is provided,
the Find First File command is issued to locate the first occurrence of the file, and then
a loop is used, calling Find Next File, to locate all other occurrences of the file within
that loop until there are no more files (error #18). Whenever Find First File is called,
it sets up the following information at the DTA: </font></p>

<pre><font face="Courier New" size="2">Offset  Description 
0       Reserved for use by Find Next File 
21      Attribute of file found
22      Time stamp of file
24      Date stamp of file
26      File size in bytes
30      Filename and extension (zero terminated)</font></pre>

<p><font face="Arial" size="2">(The offsets are decimal) </font></p>

<p><font face="Arial" size="2">Assuming Find First File doesn't return some sort of error,
the name of the first file matching the ambiguous file description will appear at offset
30 in the DTA.</font></p>

<p><font face="Arial" size="2">Note: if the specified pathname doesn't contain any
wildcard characters, then Find First File will return the exact filename specified, if it
exists. Any subsequent call to Find Next File will return an error. </font></p>

<p><font face="Arial" size="2">The <code>cx </code>register contains the search attributes
for the file. Normally, <code>cx </code>should contain zero. If non-zero, Find First File
(and Find Next File) will include file names which have the specified attributes as well
as all normal file names.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-201"></a>13.3.8.9 Find Next File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  4Fh
Entry parameters:       
                none
Exit parameters:        
                If the carry is set, 
                then there aren't any more files and 
                ax will be returned containing 18.</font></pre>

<p><font face="Arial" size="2">The Find Next File function is used to search for
additional file names matching an ambiguous file reference after a call to Find First
File. The DTA must point at a data record set up by the Find First File function. </font></p>

<p><font face="Arial" size="2">Example: The following code lists the names of all the
files in the current directory that end with &quot;.EXE&quot;. Presumably, the variable
&quot;DTA&quot; is in the current data segment:</font></p>

<pre><font face="Courier New" size="2">                mov     ah, 1Ah         ;Set DTA
                lea     dx, DTA
                int     21h
                xor     cx, cx          ;No attributes.
                lea     dx, FileName
                mov     ah, 4Eh         ;Find First File
                int     21h
                jc      NoMoreFiles     ;If error, we're done
DirLoop:        lea     si, DTA+30      ;Address of filename
                cld
PrtName:        lodsb
                test    al, al          ;Zero byte?
                jz      NextEntry
                putc                    ;Print this character
                jmp     PrtName

NextEntry:      mov     ah, 4Fh         ;Find Next File
                int     21h
                jnc     DirLoop         ;Print this name</font></pre>

<pre><strong><font face="Arial" size="3">13.3.8.10 Delete File</font></strong></pre>

<pre><font face="Courier New" size="2">Function (ah):  41h
Entry parameters:       
                ds:dx- Address of pathname to delete
Exit parameters:        
                If carry set, 
                 ax contains one of the following error codes
                  2- File not found
                  5- Access denied</font></pre>

<p><font face="Arial" size="2">This function will delete the specified file from the
directory. The filename must be an unambiguous filename (i.e., it cannot contain any
wildcard characters).</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-243"></a>13.3.8.11 Rename File</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  56h Entry parameters:
                ds:dx- Pointer to pathname of existing file 
                es:di- Pointer to new pathname
Exit parameters:        
                If carry set, 
                 ax contains one of the following error codes
                   2- File not found 
                   5- Access denied
                  17- Not the same device</font></pre>

<p><font face="Arial" size="2">This command serves two purposes: it allows you to rename
one file to another and it allows you to move a file from one directory to another (as
long as the two subdirectories are on the same disk). </font></p>

<p><font face="Arial" size="2">Example: Rename &quot;MYPGM.EXE&quot; to
&quot;YOURPGM.EXE&quot;</font></p>

<pre><font face="Courier New" size="2">; Assume ES and DS both point at the current data segment
; containing the filenames.

                lea     dx, OldName 
                lea     di, NewName
                mov     ah, 56h
                int     21h
                jc      BadRename 
                         . 
                         . 
                         .
OldName         byte    &quot;MYPGM.EXE&quot;,0
NewName         byte    &quot;YOURPGM.EXE&quot;,0</font></pre>

<p><font face="Arial" size="2">Example #2: Move a filename from one directory to another: </font></p>

<pre><font face="Courier New" size="2">; Assume ES and DS both point at the current data segment
; containing the filenames.

                lea     dx, OldName
                lea     di, NewName
                mov     ah, 56h
                int     21h
                jc      BadRename
                         .
                         .
                         .
OldName         byte    &quot;\DIR1\MYPGM.EXE&quot;,0
NewName         byte    &quot;\DIR2\MYPGM.EXE&quot;,0</font></pre>

<pre><strong><font face="Arial" size="3">13.3.8.12 Change/Get File Attributes</font></strong></pre>

<pre><font face="Courier New" size="2">Function (ah):  43h
Entry parameters:       
                al- Subfunction code
                 0- Return file attributes in cx
                 1- Set file attributes to those in cx
                cx- Attribute to be set if AL=01
                 ds:dx- address of pathname
Exit parameters:        
                If carry set, 
                 ax contains one of the following error codes:
                  1- Invalid function
                  3- Pathname not found
                  5- Access denied
                If the carry is clear and the subfunction was zero,
                 cx will contain the file's attributes.</font></pre>

<p><font face="Arial" size="2">This call is useful for setting/resetting and reading a
file's attribute bits. It can be used to set a file to read-only, set/clear the archive
bit, or otherwise mess around with the file attributes.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-304"></a>13.3.8.13 Get/Set File
Date and Time</font></strong></p>

<pre><font face="Courier New" size="2">Function (ah):  57h
Entry parameters:       
                al- Subfunction code
                 0- Get date and time
                 1- Set date and time
                bx- File handle
                cx- Time to be set (if AL=01)
                dx- Date to be set (if AL=01)
Exit parameters:        
                If carry set, ax contains one of the following error codes
                 1- Invalid subfunction
                 6- Invalid handle
                If the carry is clear, 
                 cx/dx is set to the time/date if al=00</font></pre>

<p><font face="Arial" size="2">This call sets the &quot;last-write&quot; date/time for the
specified file. The file must be open (using open or create) before using this function.
The date will not be recorded until the file is closed.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-321"></a>13.3.8.14 Other DOS
Calls</font></strong></p>

<p><font face="Arial" size="2">The following tables briefly list many of the other DOS
calls. For more information on the use of these DOS functions consult the Microsoft MS-DOS
Programmer's Reference or the MS-DOS Technical Reference. </font></p>
<div align="center"><center>

<table BORDER="1" bordercolor="#C0C0C0" width="100%" cellspacing="0" cellpadding="0">
  <caption><font face="Arial" size="2"><strong>Miscellaneous DOS File Functions</strong></font></caption>
  <tr>
    <th align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">Function #(AH)</font></strong></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Input<br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Output<br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Description</font></th>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">39h</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- pointer to zero terminated pathname.</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Create Directory: Creates a new directory with the
    specified name.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">3Ah</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- pointer to zero terminated pathname.</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Remove Directory: Deletes the directory with the specified
    pathname. Error if directory is not empty or the specified directory is the current
    directory.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">3Bh</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- pointer to zero terminated pathname.<br>
    <br>
    &nbsp;</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Change Directory: Changes the default directory to the
    specified pathname.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">45h</font></strong></td>
    <td><font face="Arial" size="2"><code>bx</code>- file handle</font></td>
    <td><font face="Arial" size="2"><code>ax</code>- new handle</font></td>
    <td><font face="Arial" size="2">Duplicate File Handle: creates a copy of a file handle so
    a program can access a file using two separate file variables. This allows the program to
    close the file with one handle and continue accessing it with the other.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">46h</font></strong></td>
    <td><font face="Arial" size="2"><code>bx</code>- file handle<br>
    <br>
    <code>cx</code>- duplicate handle</font></td>
    <td align="center"><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Force Duplicate File Handle: Like function 45h above,
    except you specify which handle (in cx) you want to refer to the existing file (specified
    by bx).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">47h</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:si</code>- pointer to buffer<br>
    <br>
    <code>dl</code>- drive</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Get Current Directory: Stores a string containing the
    current pathname (terminated with a zero) starting at location ds:si. These registers must
    point at a buffer containing at least 64 bytes. The dl register specifies the drive number
    (0=default, 1=A, 2=B, 3=C, etc.).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">5Ah</font></strong></td>
    <td><font face="Arial" size="2"><code>cx</code>- attributes<br>
    <br>
    <code>ds:dx-</code> pointer to temporary path.</font></td>
    <td><font face="Arial" size="2"><code>ax</code>- handle</font></td>
    <td><font face="Arial" size="2">Create Temporary File: Creates a file with a unique name
    in the directory specified by the zero terminated string at which ds:dx points. There must
    be at least 13 zero bytes beyond the end of the pathname because this function will store
    the generated filename at the end of the pathname. The attributes are the same as for the
    Create call.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">5Bh</font></strong></td>
    <td><font face="Arial" size="2"><code>cx</code>- attributes<br>
    <br>
    <code>ds:dx</code>- pointer to zero terminated pathname.</font></td>
    <td><font face="Arial" size="2"><code>ax</code>- handle</font></td>
    <td><font face="Arial" size="2">Create New File: Like the create call, but this call
    insists that the file not exist. It returns an error if the file exists (rather than
    deleting the old file).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">67h</font></strong></td>
    <td><font face="Arial" size="2"><code>bx</code>- handles</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Maximum Handle Count: This function sets the maximum
    number of handles a program can use at any one given time.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">68h</font></strong></td>
    <td><font face="Arial" size="2"><code>bx</code>- handle</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Commit File: Flushes all data to a file without closing
    it, ensuring that the file's data is current and consistent.</font></td>
  </tr>
</table>
</center></div>

<p>&nbsp;</p>
<div align="center"><center>

<table BORDER="1" bordercolor="#C0C0C0" width="100%" cellspacing="0" cellpadding="0">
  <caption><font face="Arial" size="2"><strong>Miscellaneous DOS Functions</strong></font></caption>
  <tr>
    <th valign="middle" bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>Function<br>
    #(AH)</strong></font></th>
    <th valign="middle" bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Input
    Parameters</font></th>
    <th valign="middle" bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Output
    Parameters</font></th>
    <th valign="middle" bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Description</font></th>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>25h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- interrupt # <code>ds:dx</code>- pointer
    to interrupt service routine.</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Interrupt Vector: Stores the specified address in
    ds:dx into the interrupt vector table at the entry specified by the al register.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>30h</strong></font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- major version <code>ah</code>- minor
    version <code>bh</code>- Version flag <code>bl</code>:cx- 24 bit serial number</font></td>
    <td><font face="Arial" size="2">Get Version Number: Returns the current version number of
    DOS (or value set by SETVER).</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>33h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- 0</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- break flag (0=off, 1=on)</font></td>
    <td><font face="Arial" size="2">Get Break Flag: Returns the status of the DOS break flag.
    If on, MS-DOS checks for ctrl-C when processing any DOS command; if off, MS-DOS only
    checks on functions 1-0Ch.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>33h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- 1 <code>dl</code>- break flag.</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Break Flag: Sets the MS-DOS break flag according to
    the value in dl (see function above for details).</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>33h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- 6</font></td>
    <td><font face="Arial" size="2"><code>bl</code>- major version <code>bh</code>- minor
    version <code>dl</code>- revision <code>dh</code>- version flags</font></td>
    <td><font face="Arial" size="2">Get MS-DOS Version: Returns the &quot;real&quot; version
    number, not the one set by the SETVER command. Bits three and four of the version flags
    are one if DOS is in ROM or DOS is in high memory, respectively.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>34h</strong></font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>es:bx</code>- pointer to InDOS flag.</font></td>
    <td><font face="Arial" size="2">Get InDOS Flag Address: Returns the address of the InDOS
    flag. This flag helps prevent reentrancy in TSR applications </font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>35h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- interrupt #</font></td>
    <td><font face="Arial" size="2"><code>es:bx</code>- pointer to interrupt service routine.</font></td>
    <td><font face="Arial" size="2">Get Interrupt Vector: Returns a pointer to the interrupt
    service routine for the specified interrupt number. See function 25h above for more
    details.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>44h</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- subcode Other parameters!</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Device Control: This is a whole family of additional DOS
    commands to control various devices. See the DOS programmer's reference manual for more
    details.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>4Dh</strong></font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- return value <code>ah</code>- termination
    method</font></td>
    <td><font face="Arial" size="2">Get Child Program Return Value: Returns the last result
    code from a child program in al. The ah register contains the termination method, which is
    one of the following values: 0-normal, 1-ctrl-C, 2-critical device error, 3-terminate and
    stay resident.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>50h</strong></font></td>
    <td><font face="Arial" size="2"><code>bx</code>- PSP address</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set PSP Address: Set DOS' current PSP address to the value
    specified in the bx register.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>51h</strong></font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>bx</code>- PSP address</font></td>
    <td><font face="Arial" size="2">Get PSP Address: Returns a pointer to the current PSP in
    the bx register.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>59h</strong></font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>ax</code>- extended error <code>bh</code>- error
    class <code>bl</code>- error action <code>ch</code>- error location</font></td>
    <td><font face="Arial" size="2">Get Extended Error: Returns additional information when an
    error occurs on a DOS call. See the DOS programmer's guide for more details on these
    errors and how to handle them.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><font face="Arial" size="2"><strong>5Dh</strong></font></td>
    <td><font face="Arial" size="2"><code>al</code>- 0Ah ds:si- pointer to extended error
    structure.</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Extended Error: copies the data from the extended
    error structure to DOS' internal record.</font></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">In addition to the above commands, there are several
additional DOS calls that deal with networks and international character sets. See the
MS-DOS reference for more details.</font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH13-5.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH13-5.html">Chapter Thirteen</a> (Part 5)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH13-7.html">Chapter Thirteen</a> (Part 7)&nbsp; </strong></font><a href="CH13-7.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div>

<p align="right"><font face="Arial" size="2"><strong>Chapter Thirteen: MS-DOS, PC-BIOS and
File I/O (Part 6)<br>
28 SEP 1996</strong></font></p>
</body>

<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_13/CH13-6.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
