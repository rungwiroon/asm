<html>
<!-- Generated by Harlequin WebMaker 2.2.6 (30-Apr-1996)Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->


<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_13/CH13-4.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="pragma" content="no-cache">
<title>CHAPTER THIRTEEN: MS-DOS, PC-BIOS AND FILE I/O (Part 4)</title>
</head>

<body topmargin="10" stylesrc="../toc.html" bgcolor="#FFFFFF" text="#000000" link="#008000" vlink="#000000">
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" colspan="3"><p align="right"><a name="top"></a><font size="1" face="Arial">The Art of<br>
    </font><font face="Arial Black" size="1">ASSEMBLY LANGUAGE PROGRAMMING</font></td>
  </tr>
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"><a NAME="HEADING4"></a></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH13-3.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH13-3.html">Chapter Thirteen</a> (Part 3)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH13-5.html">Chapter Thirteen</a> (Part 5)&nbsp; </strong></font><a href="CH13-5.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" bgcolor="#FFFFFF" nowrap height="10" colspan="2"><a NAME="HEADING4-1"></a></td>
  </tr>
  <tr>
    <td width="100%" bgcolor="#F0F0F0" colspan="2"><font face="Arial" size="4"><strong>CHAPTER
    THIRTEEN:<br>
    MS-DOS, PC-BIOS AND FILE I/O (Part 4)</strong></font></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="10" colspan="2"></td>
  </tr>
  <tr>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING4-1"><b>13.3 </b>-
    An Introduction to MS-DOS'</a> <br>
    <a HREF="#HEADING4-7"><b>13.3.1 </b>- MS-DOS Calling Sequence</a> <br>
    <a HREF="#HEADING4-9"><b>13.3.2 </b>- MS-DOS Character Oriented Functions</a> </font></td>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING4-15"><b>13.3.3 </b>-
    MS-DOS Drive Commands</a> <br>
    <a HREF="#HEADING4-17"><b>13.3.4 </b>- MS-DOS &quot;Obsolete&quot; Filing Calls</a> <br>
    <a HREF="#HEADING4-19"><b>13.3.5 </b>- MS-DOS Date and Time Functions</a></font></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="20" colspan="2"></td>
  </tr>
  <tr>
    <td width="100%" colspan="2"><strong><font face="Arial" size="3">13.3 An Introduction to
    MS-DOS'</font></strong></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="1" colspan="2" bgcolor="#000000"></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">MS-DOS provides all of the basic file manager and device
manager functions required by most application programs running on an IBM PC. MS-DOS
handles file I/O, character I/0, memory management, and other miscellaneous functions in a
(relatively) consistent manner. If you're serious about writing software for the PC,
you'll have to get real friendly with MS-DOS. </font></p>

<p><font face="Arial" size="2">The title of this section is &quot;An Introduction to
MS-DOS&quot;. And that's exactly what it means. There is no way MS-DOS can be completely
covered in a single chapter. Given all of the different books that already exist on the
subject, it probably cannot even be covered by a single book (it certainly hasn't been
yet. Microsoft wrote a 1,600 page book on the subject and it didn't even cover the subject
fully). All this is leading up to a cop-out. There is no way this subject can be treated
in more than a superficial manner in a single chapter. If you're serious about writing
programs in assembly language for the PC, you'll need to complement this text with several
others. Additional books on MS-DOS include: MS-DOS Programmer's Reference (also called the
MS-DOS Technical Reference Manual), Peter Norton's Programmer's Guide to the IBM PC, The
MS-DOS Encyclopedia, and the MS-DOS Developer's Guide. This, of course, is only a partial
list of the books that are available. See the bibliography in the appendices for more
details. Without a doubt, the MS-DOS Technical Reference Manual is the most important text
to get your hands on. This is the official description of MS-DOS calls and parameters. </font></p>

<p><font face="Arial" size="2">MS-DOS has a long and colorful history<a HREF="#FOOTNOTE-2">[2]</a>.
Throughout its lifetime, it has undergone several revisions, each purporting to be better
than the last. MS-DOS' origins go all the way back to the CP/M-80 operating system written
for the Intel 8080 microprocessor chip. In fact, MS-DOS v1.0 was nothing much more than a
clone of CP/M-80 for Intel's 8088 microprocessor. Unfortunately, CP/M-80's file handling
capabilities were horrible, to say the least. Therefore, DOS<a HREF="#FOOTNOTE-3">[3]</a>
improved on CP/M. New file handling capabilities, compatible with Xenix and Unix, were
added to DOS, producing MS-DOS v2.0. Additional calls were added to later versions of
MS-DOS. Even with the introduction of OS/2 and Windows NT (which, as this is being
written, have yet to take the world by storm), Microsoft is still working on enhancements
to MS-DOS which may produce even later versions. </font></p>

<p><font face="Arial" size="2">Each new feature added to DOS introduced new DOS functions
while preserving all of the functionality of the previous versions of DOS. When Microsoft
rewrote the DOS file handling routines in version two, they didn't replace the old calls,
they simply added new ones. While this preserved software compatibility of programs that
ran under the old version of DOS, what it produced was a DOS with two sets of functionally
identical, but otherwise incompatible, file services. </font></p>

<p><font face="Arial" size="2">We're only going to concentrate on a small subset of the
available DOS commands in this chapter. We're going to totally ignore those obsolete
commands that have been augmented by newer, better, commands in later versions of DOS.
Furthermore, we're going to skip over a description of those calls that have very little
use in day to day programming. For a complete, detailed, look at the commands not covered
in this chapter, you should consider the acquisition of one of the aforementioned books.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING4-7"></a>13.3.1 MS-DOS Calling
Sequence</font></strong></p>

<p><font face="Arial" size="2">MS-DOS is called via the <code>int 21h </code>instruction.
To select an appropriate DOS function, you load the <code>ah </code>register with a
function number before issuing the <code>int 21h </code>instruction. Most DOS calls
require other parameters as well. Generally, these other parameters are passed in the
CPU's register set. The specific parameters will be discussed along with each call. Unless
MS-DOS returns some specific value in a register, all of the CPU's registers are preserved
across a call to DOS<a HREF="#FOOTNOTE-4">[4]</a>.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING4-9"></a>13.3.2 MS-DOS Character
Oriented Functions</font></strong></p>

<p><font face="Arial" size="2">DOS provides 12 character oriented I/O calls. Most of these
deal with writing and reading data to/from the keyboard, video display, serial port, and
printer port. All of these functions have corresponding BIOS services. In fact, DOS
usually calls the appropriate BIOS function to handle the I/O operation. However, due to
DOS' redirected I/O and device driver facilities, these functions don't always call the
BIOS routines. Therefore, you shouldn't call the BIOS routines (rather than DOS) simply
because DOS ends up calling BIOS. Doing so may prevent your program from working with
certain DOS-supported devices. </font></p>

<p><font face="Arial" size="2">Except for function code seven, all of the following
character oriented calls check the console input device (keyboard) for a control-C. If the
user presses a control-C, DOS executes an <code>int 23h </code>instruction. Usually, this
instruction will cause the program to abort and control will be returned to DOS. Keep this
in mind when issuing these calls.</font></p>

<p><font face="Arial" size="2">Microsoft considers these calls obsolete and does not
guarantee they will be present in future versions of DOS. So take these first 12 routines
with a rather large grain of salt. Note that the UCR Standard Library provides the
functionality of many of these calls anyway, and they make the proper DOS calls, not the
obsolete ones.</font></p>
<div align="center"><center>

<table BORDER="1" bordercolor="#C0C0C0" width="100%" cellspacing="0" cellpadding="0">
  <caption><font face="Arial" size="2"><strong>DOS Character Oriented Functions</strong></font></caption>
  <tr>
    <th align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">Function # (AH)</font></strong></th>
    <th bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Input Parameters</font></th>
    <th bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Output Parameters</font></th>
    <th bgcolor="#F0F0F0" align="center"><font face="Arial" size="2">Description</font></th>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">1</font></strong></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- char read</font></td>
    <td><font face="Arial" size="2">Console Input w/Echo: Reads a single character from the
    keyboard and displays typed character on screen.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">2</font></strong></td>
    <td><font face="Arial" size="2"><code>dl</code>- output char</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Console Output: Writes a single character to the display.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">3</font></strong></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- char read</font></td>
    <td><font face="Arial" size="2">Auxiliary Input: Reads a single character from the serial
    port.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">4</font></strong></td>
    <td><font face="Arial" size="2"><code>dl</code>- output char</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Auxiliary Output: Writes a single character to the output
    port</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">5</font></strong></td>
    <td><font face="Arial" size="2"><code>dl</code>- output char</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Printer Output: Writes a single character to the printer</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">6</font></strong></td>
    <td><font face="Arial" size="2"><code>dl</code>- output char (if not 0FFh)</font></td>
    <td><font face="Arial" size="2"><code>al</code>- char read (if input <code>dl</code> =
    0FFh)</font></td>
    <td><font face="Arial" size="2">Direct Console I/O: On input, if <code>dl</code> contains
    0FFh, this function attempts to read a character from the keyboard. If a character is
    available, it returns the zero flag clear and the character in <code>al</code>. If no
    character is available, it returns the zero flag set. On input, if <code>dl</code>
    contains a value other than 0FFh, this routine sends the character to the display. This
    routine does not do ctrl-C checking.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">7</font></strong></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- char read</font></td>
    <td><font face="Arial" size="2">Direct Console Input: Reads a character from the keyboard.
    Does not echo the character to the display. This call does not check for ctrl-C</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">8</font></strong></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- char read</font></td>
    <td><font face="Arial" size="2">Read Keyboard w/o Echo: Just like function 7 above, except
    this call checks for ctrl-C.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">9</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- pointer to string terminated with
    &quot;$&quot;.</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Display String: This function displays the characters from
    location <code>ds:dx</code> up to (but not including) a terminating &quot;$&quot;
    character.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">0Ah</font></strong></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- pointer to input buffer.</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Buffered Keyboard Input: This function reads a line of
    text from the keyboard and stores it into the input buffer pointed at by <code>ds:dx</code>.
    The first byte of the buffer must contain a count between one and 255 that contains the
    maximum number of allowable characters in the input buffer. This routine stores the actual
    number of characters read in the second byte. The actual input characters begin at the
    third byte of the buffer.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">0Bh</font></strong></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- status (0=not ready, 0FFh=ready)</font></td>
    <td><font face="Arial" size="2">Check Keyboard Status: Determines whether a character is
    available from the keyboard.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">0Ch</font></strong></td>
    <td><font face="Arial" size="2"><code>al</code>- DOS opcode 0, 1, 6, 7, or 8</font></td>
    <td><font face="Arial" size="2"><code>al</code>- input character if opcode 1, 6, 7, or 8.</font></td>
    <td><font face="Arial" size="2">Flush Buffer: This call empties the system type ahead
    buffer and then executes the DOS command specified in the al register (if <code>al</code>=0,
    no further action).</font></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">Functions 1, 2, 3, 4, 5, 9, and 0Ah are obsolete and you
should not use them. Use the DOS file I/O calls instead (opcodes 3Fh and 40h).</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING4-15"></a>13.3.3 MS-DOS Drive
Commands</font></strong></p>

<p><font face="Arial" size="2">MS-DOS provides several commands that let you set the
default drive, determine which drive is the default, and perform some other operations.
The following table lists those functions. </font></p>
<div align="center"><center>

<table BORDER="1" bordercolor="#C0C0C0" width="100%" cellspacing="0" cellpadding="0">
  <caption><font face="Arial" size="2"><strong>DOS Disk Drive Functions</strong></font></caption>
  <tr>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Function #(AH)</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Input<br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Output<br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Description</font></th>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">0Dh</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Reset Drive: Flushes all file buffers to disk. Generally
    called by ctrl-C handlers or sections of code that need to guaranteed file consistency
    because an error may occur.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">0Eh</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- drive number</font></td>
    <td><font face="Arial" size="2"><code>al</code>- number of logical drives</font></td>
    <td><font face="Arial" size="2">Set Default Drive: sets the DOS default drive to the
    specified value (0=A, 1=B, 2=C, etc.). Returns the number of logical drives in the system,
    although they may not be contiguous from 0-<code>al</code>.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">19H</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- default drive number</font></td>
    <td><font face="Arial" size="2">Get Default Drive: Returns the current system default
    drive number (0=A, 1=B, 2=C, etc.).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">1Ah</font></td>
    <td><font face="Arial" size="2"><code>ds:dx</code>- Disk Transfer Area address.</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Disk Transfer Area Address: Sets the address that
    MS-DOS uses for obsolete file I/O and Find First/Find Next commands.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">1Bh-</font></td>
    <td><font face="Arial" size="2">&nbsp;</font></td>
    <td><font face="Arial" size="2"><code>al</code>- sectors/cluster<br>
    <br>
    <code>cx</code>- bytes/sector<br>
    <br>
    <code>dx</code>- # of clusters<br>
    <br>
    <code>ds:bx</code> - points at media descriptor byte</font></td>
    <td><font face="Arial" size="2">Get Default Drive Data: Returns information about the disk
    in the default drive. Also see function 36h. Typical values for the media descriptor byte
    include:<br>
    <br>
    0F0h- 3.5&quot;<br>
    <br>
    0F8h- Hard disk<br>
    <br>
    0F9h- 720K 3.5&quot; or 1.2M 5.25&quot;<br>
    <br>
    0FAh- 320K 5.25&quot;<br>
    <br>
    0FBh- 640K 3.5&quot;<br>
    <br>
    0FCh- 180K 5.25&quot;<br>
    <br>
    0FDh- 360K 5.25:<br>
    <br>
    0FEh- 160K 5.25&quot;<br>
    <br>
    0FFh- 320K 5.25&quot;</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">1Ch</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- drive number</font></td>
    <td><font face="Arial" size="2">See above</font></td>
    <td><font face="Arial" size="2">Get Drive Data: same as above except you can specify the
    drive number in the dl register (0=default, 1=A, 2=B, 3=C, etc.).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">1Fh</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- contains 0FFh if error, 0 if no error.<br>
    <br>
    <code>ds:bx</code>- ptr to DPB</font></td>
    <td><font face="Arial" size="2">Get Default Disk Parameter Block (DPB): If successful,
    this function returns a pointer to the following structure:<br>
    <br>
    Drive (byte) - Drive number (0-A, 1=B, etc.).<br>
    <br>
    Unit (byte) - Unit number for driver.<br>
    <br>
    SectorSize (word) - # bytes/sector.<br>
    <br>
    ClusterMask (byte) - sectors/cluster minus one.<br>
    <br>
    Cluster2 (byte) - 2clusters/sector<br>
    <br>
    FirstFAT (word) - Address of sector where FAT starts.<br>
    <br>
    FATCount (byte) - # of FATs.<br>
    <br>
    RootEntries (word) - # of entries in root directory.<br>
    <br>
    FirstSector (word) - first sector of first cluster.<br>
    <br>
    MaxCluster (word) - # of clusters on drive, plus one.<br>
    <br>
    FATsize (word) - # of sectors for FAT.<br>
    <br>
    DirSector (word) - first sector containing directory.<br>
    <br>
    DriverAdrs (dword) - address of device driver.<br>
    <br>
    Media (byte) - media descriptor byte.<br>
    <br>
    FirstAccess (byte) - set if there has been an access to drive.<br>
    <br>
    NextDPB (dword) - link to next DPB in list.<br>
    <br>
    NextFree (word) - last allocated cluster.<br>
    <br>
    FreeCnt (word) - number of free clusters.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">2Eh</font></td>
    <td><font face="Arial" size="2"><code>al</code>- verify flag (0=no verify, 1=verify on).</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set/Reset Verify Flag: Turns on and off write
    verification. Usually off since this is a slow operation, but you can turn it on when
    performing critical I/O.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">2Fh</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>es:bx</code>- pointer to DTA</font></td>
    <td><font face="Arial" size="2">Get Disk Transfer Area Address: Returns a pointer to the
    current DTA in <code>es:bx</code>..</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">32h</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- drive number.</font></td>
    <td><font face="Arial" size="2">Same as 1Fh</font></td>
    <td><font face="Arial" size="2">Get DPB: Same as function 1Fh except you get to specify
    the driver number (0=default, 1=A, 2=B, 3=C, etc.).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">33h</font></td>
    <td><font face="Arial" size="2"><code>al</code>- 05 (subfunction code)</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- startup drive #.</font></td>
    <td><font face="Arial" size="2">Get Startup Drive: Returns the number of the drive used to
    boot DOS (1=A, 2=B, 3=C, etc.).</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">36h</font></td>
    <td><font face="Arial" size="2"><code>dl</code>- drive number.</font></td>
    <td><font face="Arial" size="2"><code>ax</code>- sectors/cluster<br>
    <br>
    <code>bx</code>- available clusters<br>
    <br>
    <code>cx</code>- bytes/sector<br>
    <br>
    <code>dx</code>- total clusters</font></td>
    <td><font face="Arial" size="2">Get Disk Free Space: Reports the amount of free space.
    This call supersedes calls 1Bh and 1Ch that only support drives up to 32Mbytes. This call
    handles larger drives. You can compute the amount of free space (in bytes) by bx*ax*cx. If
    an error occurs, this call returns 0FFFFh in <code>ax</code>.</font></td>
  </tr>
  <tr>
    <td align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">54h</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- verify state.</font></td>
    <td><font face="Arial" size="2">Get Verify State: Returns the current state of the write
    verify flag (<code>al</code>=0 if off, <code>al</code>=1 if on).</font></td>
  </tr>
</table>
</center></div>

<p><strong><font face="Arial" size="3"><a NAME="HEADING4-17"></a>13.3.4 MS-DOS
&quot;Obsolete&quot; Filing Calls</font></strong></p>

<p><font face="Arial" size="2">DOS functions 0Fh - 18h, 1Eh, 20h-24h, and 26h - 29h are
the functions left over from the days of CP/M-80. In general, you shouldn't bother at all
with these calls since MS-DOS v2.0 and later provides a much better way to accomplish the
operations performed by these calls.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING4-19"></a>13.3.5 MS-DOS Date and
Time Functions</font></strong></p>

<p><font face="Arial" size="2">The MS-DOS date and time functions return the current date
and time based on internal values maintained by the real time clock (RTC). Functions
provided by DOS include reading and setting the date and time. These date and time values
are used to perform date and time stamping of files when files are created on the disk.
Therefore, if you change the date or time, keep in mind that it will have an effect on the
files you create thereafter. Note that the UCR Standard Library also provides a set of
date and time functions which, in many cases, are somewhat easier to use than these DOS
calls. </font></p>
<div align="center"><center>

<table BORDER="1" bordercolor="#C0C0C0" width="100%" cellspacing="0" cellpadding="0">
  <caption><font face="Arial" size="2"><strong>Date and Time Functions</strong></font></caption>
  <tr>
    <th align="center" bgcolor="#F0F0F0"><strong><font face="Arial" size="2">Function #<br>
    <br>
    (AH)</font></strong></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Input<br>
    <br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Output<br>
    <br>
    Parameters</font></th>
    <th align="center" bgcolor="#F0F0F0"><font face="Arial" size="2">Description</font></th>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><strong><font face="Arial" size="2">2Ah</font></strong></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>al</code>- day (0=Sun, 1=Mon, etc.).<br>
    <br>
    <code>cx</code>- year<br>
    <br>
    <code>dh</code>- month (1=Jan, 2=Feb, etc.).<br>
    <br>
    <code>dl</code>- Day of month (1-31).</font></td>
    <td><font face="Arial" size="2">Get Date: returns the current MS-DOS date.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><strong><font face="Arial" size="2">2Bh</font></strong></td>
    <td><font face="Arial" size="2"><code>cx</code>- year (1980 - 2099)<br>
    <br>
    <code>dh</code>- month (1-12)<br>
    <br>
    <code>dl</code>- day (1-31)</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Date: sets the current MS-DOS date.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0" align="center"><strong><font face="Arial" size="2">2CH</font></strong></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2"><code>ch</code>- hour (24hr fmt)<br>
    <br>
    <code>cl</code>- minutes<br>
    <br>
    <code>dh</code>- seconds<br>
    <br>
    <code>dl</code>- hundredths</font></td>
    <td><font face="Arial" size="2">Get Time: reads the current MS-DOS time. Note that the
    hundredths of a second field has a resolution of 1/18 second.</font></td>
  </tr>
  <tr>
    <td bgcolor="#F0F0F0"><p align="center"><strong><font face="Arial" size="2">2Dh</font></strong></td>
    <td><font face="Arial" size="2"><code>ch</code>- hour<br>
    <br>
    <code>cl</code>- minutes<br>
    <br>
    <code>dh</code>- seconds<br>
    <br>
    <code>dl</code>- hundredths</font></td>
    <td><p align="center"><font face="Arial" size="2">-</font></td>
    <td><font face="Arial" size="2">Set Time: sets the current MS-DOS time.</font></td>
  </tr>
</table>
</center></div>

<hr noshade size="1" color="#000000">

<p><font face="Arial" size="2"><strong><a NAME="FOOTNOTE-2"></a>[2] </strong>The MS-DOS
Encyclopedia gives Microsoft's account of the history of MS-DOS. Of course, this is a
one-sided presentation, but it's interesting nonetheless. <br>
<strong><a NAME="FOOTNOTE-3"></a>[3] </strong>This text uses &quot;DOS&quot; to mean
MS-DOS. <br>
<strong><a NAME="FOOTNOTE-4"></a>[4]</strong> So Microsoft claims. This may or may not be
true across all versions of DOS.</font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH13-3.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH13-3.html">Chapter Thirteen</a> (Part 3)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH13-5.html">Chapter Thirteen</a> (Part 5)&nbsp; </strong></font><a href="CH13-5.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div>

<p align="right"><font face="Arial" size="2"><strong>Chapter Thirteen: MS-DOS, PC-BIOS and
File I/O (Part 4)<br>
28 SEP 1996</strong></font></p>
</body>

<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_13/CH13-4.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
