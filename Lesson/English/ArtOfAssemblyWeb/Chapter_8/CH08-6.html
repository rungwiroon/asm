<html>
<!-- Generated by Harlequin WebMaker 2.2.6 (30-Apr-1996)Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->


<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_8/CH08-6.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:26:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="pragma" content="no-cache">
<title>CHAPTER EIGHT: MASM: DIRECTIVES &amp; PSEUDO-OPCODES (Part 6)</title>
</head>

<body topmargin="10" stylesrc="../toc.html" bgcolor="#FFFFFF" text="#000000" link="#008000" vlink="#000000">
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" colspan="3"><p align="right"><a name="top"></a><font size="1" face="Arial">The Art of<br>
    </font><font face="Arial Black" size="1">ASSEMBLY LANGUAGE PROGRAMMING</font></td>
  </tr>
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"><a NAME="HEADING6"></a></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH08-5.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH08-5.html">Chapter Eight</a> (Part 5)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH08-7.html">Chapter Eight</a> (Part 7) </strong></font><a href="CH08-7.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" bgcolor="#FFFFFF" nowrap height="10" colspan="2"><a NAME="HEADING6-1"></a></td>
  </tr>
  <tr>
    <td width="100%" bgcolor="#F0F0F0" colspan="2"><font face="Arial" size="4"><strong>CHAPTER
    EIGHT:<br>
    MASM: DIRECTIVES &amp; PSEUDO-OPCODES (Part 6)</strong></font></td>
  </tr>
  <tr>
    <td width="100%" nowrap height="10" colspan="2"></td>
  </tr>
  <tr>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING6-1"><b>8.13 </b>-
    Conditional Assembly</a> <br>
    <a HREF="#HEADING6-10"><b>8.13.1 </b>- IF Directive</a> <br>
    <a HREF="#HEADING6-36"><b>8.13.2 </b>- IFE directive</a> </font></td>
    <td width="50%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING6-38"><b>8.13.3 </b>-
    IFDEF and IFNDEF</a> <br>
    <a HREF="#HEADING6-51"><b>8.13.4 </b>- IFB, IFNB</a> <br>
    <a HREF="#HEADING6-69"><b>8.13.5 </b>- IFIDN, IFDIF, IFIDNI, and IFDIFI</a> </font></td>
  </tr>
  <tr>
    <td width="100%" valign="top" nowrap height="20" colspan="2"></td>
  </tr>
  <tr>
    <td width="100%" valign="top" colspan="2"><strong><font face="Arial" size="3">8.13
    Conditional Assembly</font></strong></td>
  </tr>
  <tr>
    <td width="100%" valign="top" nowrap height="1" colspan="2" bgcolor="#000000"></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">MASM provides a very powerful conditional assembly
facility. With conditional assembly, you can decide, based on certain conditions, whether
MASM will assemble the code. There are several conditional assembly directives, the
following section covers most of them.</font></p>

<p><font face="Arial" size="2">It is important that you realize that these directives
evaluate their expressions at assembly time, not at run time. The <code>if </code>conditional
assembly directive is not the same as a Pascal or C &quot;if&quot; statement. If you are
familiar with C, the <code>#ifdef </code>directive in C is roughly equivalent to some of
MASM's conditional assembly directives. </font></p>

<p><font face="Arial" size="2">MASM's conditional assembly directives are important
because they let you generate different object code for different operating environments
and different situations. For example, suppose you want to write a program that will run
on all machines but you would like to optimize the code for 80386 and later processors.
Obviously, you cannot execute 80386 code on an 8086 processor, so how can you solve this
problem?</font></p>

<p><font face="Arial" size="2">One possible solution is to determine the processor type at
run time and execute different sections of code in the program depending on the presence
or absence of a 386 or later CPU. The problem with this approach is that your program
needs to contain two code sequences - an optimal 80386 sequence and a compatible 8086
sequence. On any given system the CPU will only execute one of these code sequences in the
program, so the other sequence will be wasting memory and may have adverse affects on any
cache in the system. </font></p>

<p><font face="Arial" size="2">A second possibility is to write two versions of the code,
one that uses only 8086 instructions and one that uses the full 80386 instruction set.
During installation, the user (or the installation program) selects the 80386 version if
they have an 80386 or later processor. Otherwise they select the 8086 version. While this
marginally increases the cost of the software since it will require more disk space, the
program will consume less memory while running. The problem with this approach is that you
will need to maintain two separate versions of the program. If you correct a bug in the
8086 version of the code, you will probably need to correct that same bug in the 80386
program. Maintaining multiple source files is a difficult task.</font></p>

<p><font face="Arial" size="2">A third solution is to use conditional assembly. With
conditional assembly, you can merge the 8086 and 80386 versions of the code into the same
source file. During assembly, you can conditionally choose whether MASM assembles the 8086
or the 80386 version. By assembling the code twice, you can produce an 8086 and an 80386
version of the code. Since both versions of the code appear in the same source file, the
program will be much easier to maintain since you will not have to correct the same bug in
two separate source files. You may need to correct the same bug twice in two separate code
sequences in the program, but generally the bug will appear in two adjacent code
sequences, so it is less likely that you will forget to make the change in both places.</font></p>

<p><font face="Arial" size="2">MASM's conditional assembly directives are especially
useful within macros. They can help you produce efficient code when a macro would normally
produce sub-optimal code. For more information about macros and how you can use
conditional assembly within a macro, see &quot;Macros&quot;.</font></p>

<p><font face="Arial" size="2">Macros and conditional assembly actually provide &quot;a
programming language within a programming language.&quot; Macros and conditional assembly
let you write programs (in the &quot;macro language&quot;) that write segments of assembly
language code for you. This introduces an independent way to generate bugs in your
application programs. Not only can a bug develop in your assembly language code, you can
also introduce bugs in your macro code (e.g., conditional assembly), that wind up
producing bugs in your assembly language code. Keep in mind that if you get too
sophisticated when using conditional assembly, you can produce programs that are very
difficult to read, understand, and debug.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-10"></a>8.13.1 IF Directive</font></strong></p>

<p><font face="Arial" size="2">The <code>if </code>directive uses the following syntax: </font></p>

<pre><font face="Arial" size="2">                if      expression
                
        &lt;sequence of statements&gt;
        
                else    ;This is optional!
                
        &lt;sequence of statements&gt;
        
                endif</font></pre>

<p><font face="Arial" size="2">MASM evaluates expression. If it is a non-zero value, then
MASM will assemble the statements between the <code>if </code>and <code>else </code>directives<code>
</code>(or <code>endif</code>, if the <code>else </code>isn't present). If the expression
evaluates to zero (false) and an <code>else </code>section is present, MASM will assemble
the statements between the <code>else </code>directive and the <code>endif </code>directive.
If the <code>else </code>section is not present and expression evaluates to false, then
MASM will not assemble any of the code between the <code>if </code>and <code>endif </code>directives.</font></p>

<p><font face="Arial" size="2">The important thing to remember is that expression has to
be an expression that MASM can evaluate at assembly time. That is, it must evaluate to a
constant. Manifest constants (equates) and values that MASM's type operators produce are
commonly found in <code>if</code> directive expressions. For example, suppose you want to
assemble code for two different processors as described above. You could use statements
like the following: </font></p>

<pre><font face="Courier New" size="2">Processor       =       80386           ;Set to 8086 for 8086-only code
                .
                .
                .
                if      Processor eq 80386
                shl     ax, 4
                else                    ;Must be 8086 processor.
                mov     cl, 4
                shl     ax, cl
                endif</font></pre>

<p><font face="Arial" size="2">There are other ways to accomplish this same thing. MASM
provides built-in variables that tell you if you are assembling code for some specific
processor. More on that later.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-36"></a>8.13.2 IFE directive</font></strong></p>

<p><font face="Arial" size="2">The <code>ife </code>directive is used exactly like the <code>if
</code>directive, except it assembles the code after the <code>ife </code>directive only
if the expression evaluates to zero (false), rather than true (non-zero).</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-38"></a>8.13.3 IFDEF and IFNDEF</font></strong></p>

<p><font face="Arial" size="2">These two directives require a single symbol as the
operand. <code>Ifdef </code>will assemble the associated code if the symbol is defined, <code>Ifndef
</code>will assemble the associated code if the symbol isn't defined. Use <code>else </code>and
<code>endif </code>to terminate the conditional assembly sequences. </font></p>

<p><font face="Arial" size="2">These directives are especially popular for including or
not including code in an assembly language program to handle certain special cases. For
example, you could use statements like the following to include debugging statements in
your code: </font></p>

<pre><font face="Courier New" size="2">                ifdef   DEBUG

                &lt;place debugging statements here&gt;

                endif</font></pre>

<p><font face="Arial" size="2">To activate the debugging code, simply define the symbol <code>DEBUG</code>
somewhere at the beginning of your program (before the first <code>ifdef </code>referencing
<code>DEBUG</code>). To automatically eliminate the debugging code, simply delete the
definition of <code>DEBUG</code>. You may define <code>DEBUG</code> using a simple
statement like: </font></p>

<pre><font face="Courier New" size="2">DEBUG           =       0</font></pre>

<p><font face="Arial" size="2">Note that the value you assign to <code>DEBUG</code> is
unimportant. Only the fact that you have defined (or have not defined) this symbol is
important.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING6-51"></a>8.13.4 IFB, IFNB</font></strong></p>

<p><font face="Arial" size="2">These directives, useful mainly in macros (see
&quot;Macros&quot;) check to see if an operand is blank (<code>ifb</code>) or not blank (<code>ifnb</code>).
Consider the following code: </font></p>

<pre><font face="Courier New" size="2">Blank           textequ &lt;&gt;
NotBlank        textequ &lt;not blank&gt;

                ifb     Blank
                
        &lt;this code will assemble&gt;
                
                endif

                ifb     NotBlank
                
        &lt;this code will not&gt;
        
                endif</font></pre>

<p><font face="Arial" size="2">The <code>ifnb </code>works in an opposite manner to <code>ifb</code>.
That is, it would assemble the statements above that <code>ifb </code>does not and vice
versa.</font></p>

<p><font face="Arial" size="3"><strong><a NAME="HEADING6-69"></a>8.13.5 IFIDN, IFDIF,
IFIDNI, and IFDIFI</strong></font></p>

<p><font face="Arial" size="2">These conditional assembly directives take two operands and
process the associated code if the operands are identical (<code>ifidn</code>), different
(<code>ifdif</code>), identical ignoring case (<code>ifidni</code>), or different ignoring
case (<code>ifdifi</code>). The syntax is </font></p>

<pre><font face="Courier New" size="2">                ifidn   op1, op2
                
        &lt;statements to assemble if &lt;op1&gt; == &lt;op2&gt;&gt;
        
                endif

                ifdif   op1, op2
                
        &lt;statements to assemble if &lt;op1&gt; != &lt;op2&gt;&gt;
        
                endif

                ifidni  op1, op2
                
        &lt;statements to assemble if &lt;op1&gt; == &lt;op2&gt;&gt;
        
                endif

                ifdifi  op1, op2
                
        &lt;statements to assemble if &lt;op1&gt; != &lt;op2&gt;&gt;
        
                endif</font></pre>

<p><font face="Arial" size="2">The difference between the <code>IFxxx</code> and <code>IFxxxI</code>
statements above is that the <code>IFxxxI</code> statements ignore differences in
alphabetic case when comparing operands. </font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="CH08-5.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="CH08-5.html">Chapter Eight</a> (Part 5)</strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH08-7.html">Chapter Eight</a> (Part 7) </strong></font><a href="CH08-7.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div>

<p align="right"><font face="Arial" size="2"><strong>Chapter Eight: MASM: Directives &amp;
Pseudo-Opcodes (Part 6)<br>
26 SEP 1996</strong></font></p>
</body>

<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_8/CH08-6.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:26:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
