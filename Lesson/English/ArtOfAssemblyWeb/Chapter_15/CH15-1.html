<html>
<!-- Generated by Harlequin WebMaker 2.2.6 (30-Apr-1996)Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->


<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_15/CH15-1.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="pragma" content="no-cache">
<title>CHAPTER FIFTEEN: STRINGS AND CHARACTER SETS (Part 1)</title>
</head>

<body stylesrc="../toc.html" topmargin="10" bgcolor="#FFFFFF" text="#000000" link="#008000" vlink="#000000">
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" colspan="3"><p align="right"><a name="top"></a><font size="1" face="Arial">The Art of<br>
    </font><font face="Arial Black" size="1">ASSEMBLY LANGUAGE PROGRAMMING</font></td>
  </tr>
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"><a NAME="HEADING1"></a></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="../Chapter_14/CH14-1.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="../Chapter_14/CH14-1.html">Chapter
    Fourteen</a></strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH15-2.html">Chapter Fifteen</a> (Part 2)&nbsp; </strong></font><a href="CH15-2.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div><div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" colspan="3" bgcolor="#FFFFFF" nowrap height="10"><a NAME="HEADING1-0"></a></td>
  </tr>
  <tr>
    <td width="100%" colspan="3" bgcolor="#F0F0F0"><font face="Arial" size="4"><strong>CHAPTER
    FIFTEEN:<br>
    STRINGS AND CHARACTER SETS (Part 1)</strong></font></td>
  </tr>
  <tr>
    <td width="100%" colspan="3" nowrap height="10"></td>
  </tr>
  <tr>
    <td width="40%" valign="top"><font face="Arial" size="2"><a HREF="#HEADING1-3"><b>15.0 </b>-
    Chapter Overview</a> <br>
    <a HREF="#HEADING1-10"><b>15.1 </b>- The 80x86 String Instructions</a> <br>
    <a HREF="#HEADING1-12"><b>15.1.1 </b>- How the String Instructions Operate</a> <br>
    <a HREF="#HEADING1-23"><b>15.1.2 </b>- The REP/REPE/REPZ and REPNZ/REPNE Prefixes</a> <br>
    <a HREF="#HEADING1-55"><b>15.1.3 </b>- The Direction Flag</a> <br>
    <a HREF="CH15-2.html#HEADING2-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-1"><b>15.1.4
    </b>- The MOVS Instruction</a> <br>
    <a HREF="CH15-2.html#HEADING2-72" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-72"><b>15.1.5
    </b>- The CMPS Instruction</a> <br>
    <a HREF="CH15-2.html#HEADING2-134" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-134"><b>15.1.6
    </b>- The SCAS Instruction</a> <br>
    <a HREF="CH15-2.html#HEADING2-150" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-150"><b>15.1.7
    </b>- The STOS Instruction</a> <br>
    <a HREF="CH15-2.html#HEADING2-170" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-170"><b>15.1.8
    </b>- The LODS Instruction</a> <br>
    <a HREF="CH15-2.html#HEADING2-180" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-180"><b>15.1.9
    </b>- Building Complex String Functions from LODS and STOS</a><br>
    <a HREF="CH15-2.html#HEADING2-213" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-2.html#HEADING2-213"><b>15.1.10
    </b>- Prefixes and the String Instructions</a> <br>
    <a HREF="CH15-3.html#HEADING3-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-3.html#HEADING3-1"><b>15.2 </b>-
    Character Strings</a> <br>
    <a HREF="CH15-3.html#HEADING3-3" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-3.html#HEADING3-3"><b>15.2.1
    </b>- Types of Strings</a> <br>
    <a HREF="CH15-3.html#HEADING3-27" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-3.html#HEADING3-27"><b>15.2.2
    </b>- String Assignment</a> <br>
    <a HREF="CH15-3.html#HEADING3-145" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-3.html#HEADING3-145"><b>15.2.3
    </b>- String Comparison</a> <b><br>
    <a HREF="CH15-4.html#HEADING4-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-1">15.3 </b>-
    Character String Functions</a> <br>
    <a HREF="CH15-4.html#HEADING4-3" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-3"><b>15.3.1
    </b>- Substr</a> <br>
    <a HREF="CH15-4.html#HEADING4-153" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-153"><b>15.3.2
    </b>- Index</a> <br>
    <a HREF="CH15-4.html#HEADING4-264" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-264"><b>15.3.3
    </b>- Repeat</a> <br>
    <a HREF="CH15-4.html#HEADING4-294" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-294"><b>15.3.4
    </b>- Insert</a> <br>
    <a HREF="CH15-4.html#HEADING4-395" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-395"><b>15.3.5
    </b>- Delete</a> <br>
    <a HREF="CH15-4.html#HEADING4-481" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-4.html#HEADING4-481"><b>15.3.6
    </b>- Concatenation</a> <br>
    <a HREF="CH15-5.html#HEADING5-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-1"><b>15.4 </b>-
    String Functions in the UCR Standard Library</a> <br>
    <a HREF="CH15-5.html#HEADING5-6" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-6"><b>15.4.1
    </b>- StrBDel, StrBDelm</a> <br>
    <a HREF="CH15-5.html#HEADING5-48" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-48"><b>15.4.2
    </b>- Strcat, Strcatl, Strcatm, Strcatml</a> <br>
    <a HREF="CH15-5.html#HEADING5-124" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-124"><b>15.4.3
    </b>- Strchr</a> <br>
    <a HREF="CH15-5.html#HEADING5-153" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-153"><b>15.4.4
    </b>- Strcmp, Strcmpl, Stricmp, Stricmpl</a> <br>
    <a HREF="CH15-5.html#HEADING5-213" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-213"><b>15.4.5
    </b>- Strcpy, Strcpyl, Strdup, Strdupl</a> <br>
    <a HREF="CH15-5.html#HEADING5-251" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-251"><b>15.4.6
    </b>- Strdel, Strdelm</a> <br>
    <a HREF="CH15-5.html#HEADING5-278" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-278"><b>15.4.7
    </b>- Strins, Strinsl, Strinsm, Strinsml</a> <br>
    <a HREF="CH15-5.html#HEADING5-323" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-323"><b>15.4.8
    </b>- Strlen</a> <br>
    <a HREF="CH15-5.html#HEADING5-337" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-337"><b>15.4.9
    </b>- Strlwr, Strlwrm, Strupr, Struprm</a> <br>
    <a HREF="CH15-5.html#HEADING5-376" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-376"><b>15.4.10
    </b>- Strrev, Strrevm</a> <br>
    <a HREF="CH15-5.html#HEADING5-402" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-402"><b>15.4.11
    </b>- Strset, Strsetm</a> <br>
    <a HREF="CH15-5.html#HEADING5-426" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-426"><b>15.4.12
    </b>- Strspan, Strspanl, Strcspan, Strcspanl</a> <br>
    <a HREF="CH15-5.html#HEADING5-476" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-476"><b>15.4.13
    </b>- Strstr, Strstrl</a> <br>
    <a HREF="CH15-5.html#HEADING5-508" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-508"><b>15.4.14
    </b>- Strtrim, Strtrimm</a> <br>
    <a HREF="CH15-5.html#HEADING5-555" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-5.html#HEADING5-555"><b>15.4.15
    </b>- Other String Routines in the UCR Standard Library</a> <br>
    <a HREF="CH15-6.html#HEADING6-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-6.html#HEADING6-1"><b>15.5 </b>-
    The Character Set Routines in the UCR Standard Library</a> <br>
    <a HREF="CH15-6.html#HEADING6-101" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-6.html#HEADING6-101"><b>15.6
    </b>- Using the String Instructions on Other Data Types</a> <br>
    <a HREF="CH15-6.html#HEADING6-103" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-6.html#HEADING6-103"><b>15.6.1
    </b>- Multi-precision Integer Strings</a> <br>
    <a HREF="CH15-6.html#HEADING6-113" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-6.html#HEADING6-113"><b>15.6.2
    </b>- Dealing with Whole Arrays and Records</a> <br>
    <a HREF="CH15-7.html#HEADING7-1" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-7.html#HEADING7-1"><b>15.7 </b>-
    Sample Programs</a> <br>
    <a HREF="CH15-7.html#HEADING7-3" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-7.html#HEADING7-3"><b>15.7.1
    </b>- Find.asm</a> <br>
    <a HREF="CH15-7.html#HEADING7-164" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-7.html#HEADING7-164"><b>15.7.2
    </b>- StrDemo.asm</a> <br>
    <a HREF="CH15-7.html#HEADING7-343" tppabs="http://webster.cs.ucr.edu/asm/ArtofAssembly/CH15/CH15-7.html#HEADING7-343"><b>15.7.3
    </b>- Fcmp.asm</a> </font></td>
    <td width="20" nowrap valign="top"></td>
    <td width="60%" valign="top"><font size="1" face="Arial">Copyright 1996 by Randall Hyde
    All rights reserved. <br>
    <br>
    Duplication other than for immediate display through a browser is prohibited by U.S.
    Copyright Law. <br>
    This material is provided on-line as a beta-test of this text. It is for the personal use
    of the reader only. If you are interested in using this material as part of a course,
    please contact rhyde@cs.ucr.edu <br>
    <br>
    Supporting software and other materials are available via anonymous ftp from
    ftp.cs.ucr.edu. See the &quot;/pub/pc/ibmpcdir&quot; directory for details. You may also
    download the material from &quot;Randall Hyde's Assembly Language Page&quot; at URL:
    http://webster.ucr.edu<br>
    <br>
    Notes: <br>
    This document does not contain the laboratory exercises, programming assignments,
    exercises, or chapter summary. These portions were omitted for several reasons: either
    they wouldn't format properly, they contained hyperlinks that were too much work to
    resolve, they were under constant revision, or they were not included for security
    reasons. Such omission should have very little impact on the reader interested in learning
    this material or evaluating this document. <br>
    <br>
    This document was prepared using Harlequin's Web Maker 2.2 and Quadralay's Webworks
    Publisher. Since HTML does not support the rich formatting options available in
    Framemaker, this document is only an approximation of the actual chapter from the
    textbook. <br>
    <br>
    If you are absolutely dying to get your hands on a version other than HTML, you might
    consider having the UCR Printing a Reprographics Department run you off a copy on their
    Xerox machines. For details, please read the following EMAIL message I received from the
    Printing and Reprographics Department: </font><blockquote>
      <p><font size="1" face="Arial">Hello Again Professor Hyde,<br>
      <br>
      Dallas gave me permission to take orders for the Computer Science 13 Manuals. We would
      need to take charge card orders. The only cards we take are: Master Card, Visa, and
      Discover. They would need to send the name, numbers, expiration date, type of card, and
      authorization to charge $95.00 for the manual and shipping, also we should have their
      phone number in case the company has any trouble delivery. They can use my e-mail address
      for the orders and I will process them as soon as possible. I would assume that two weeks
      would be sufficient for printing, packages and delivery time.<br>
      <br>
      I am open to suggestions if you can think of any to make this as easy as possible.<br>
      <br>
      Thank You for your business,<br>
      Kathy Chapman, Assistant<br>
      Printing and Reprographics University of California Riverside (909) 787-4443/4444 </font></p>
    </blockquote>
    <p><font size="1" face="Arial">We are currently working on ways to publish this text in a
    form other than HTML (e.g., Postscript, PDF, Frameviewer, hard copy, etc.). This, however,
    is a low-priority project. Please do not contact Randall Hyde concerning this effort. When
    something happens, an announcement will appear on &quot;Randall Hyde's Assembly Language
    Page.&quot; Please visit this WEB site at http://webster.ucr.edu for the latest scoop.</font></p>
    <p><font size="1" face="Arial">Redesigned 10/2000 with &quot;MS FrontPage 98&quot; using
    17&quot; monitor 1024x768<br>
    (c) 2000 <a href="mail%20to_%20bircom_yanoo.html">BIRCOM Entertainment'95</a></font></td>
  </tr>
</table>
</center></div>

<hr noshade size="1" color="#000000">

<p><font face="Arial" size="2">A string is a collection of objects stored in contiguous
memory locations. Strings are usually arrays of bytes, words, or (on 80386 and later
processors) double words. The 80x86 microprocessor family supports several instructions
specifically designed to cope with strings. This chapter explores some of the uses of
these string instructions. </font></p>

<p><font face="Arial" size="2">The 8088, 8086, 80186, and 80286 can process two types of
strings: byte strings and word strings. The 80386 and later processors also handle double
word strings. They can move strings, compare strings, search for a specific value within a
string, initialize a string to a fixed value, and do other primitive operations on
strings. The 80x86's string instructions are also useful for manipulating arrays, tables,
and records. You can easily assign or compare such data structures using the string
instructions. Using string instructions may speed up your array manipulation code
considerably. </font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%"><strong><font face="Arial" size="3"><a NAME="HEADING1-3"></a>15.0 Chapter
    Overview</font></strong></td>
  </tr>
  <tr>
    <td width="100%" nowrap bgcolor="#000000" height="1"></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">This chapter presents a review of the operation of the
80x86 string instructions. Then it discusses how to process character strings using these
instructions. Finally, it concludes by discussing the string instruction available in the
UCR Standard Library. The sections below that have a &quot;*&quot; prefix are essential.
Those sections with a &quot;o&quot; discuss advanced topics that you may want to put off
for a while.</font></p>

<p><font face="Arial" size="2">* The 80x86 string instructions.</font></p>

<p><font face="Arial" size="2">* Character strings.</font></p>

<p><font face="Arial" size="2">* Character string functions.</font></p>

<p><font face="Arial" size="2">* String functions in the UCR Standard Library.</font></p>

<p><font face="Arial" size="2">&nbsp;&nbsp;&nbsp; o Using the string instructions on other
data types.</font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%"><strong><font face="Arial" size="3"><a NAME="HEADING1-10"></a>15.1 The
    80x86 String Instructions</font></strong></td>
  </tr>
  <tr>
    <td width="100%" nowrap bgcolor="#000000" height="1"></td>
  </tr>
</table>
</center></div>

<p><font face="Arial" size="2">All members of the 80x86 family support five different
string instructions: <code>movs</code>, <code>cmps, scas, lods,</code> and <code>stos<a HREF="#FOOTNOTE-1">[1]</a></code>. They are the string primitives since you can build most
other string operations from these five instructions. How you use these five instructions
is the topic of the next several sections.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING1-12"></a>15.1.1 How the String
Instructions Operate</font></strong></p>

<p><font face="Arial" size="2">The string instructions operate on blocks (contiguous
linear arrays) of memory. For example, the <code>movs </code>instruction moves a sequence
of bytes from one memory location to another. The <code>cmps </code>instruction compares
two blocks of memory. The <code>scas </code>instruction scans a block of memory for a
particular value. These string instructions often require three operands, a destination
block address, a source block address, and (optionally) an element count. For example,
when using the <code>movs </code>instruction to copy a string, you need a source address,
a destination address, and a count (the number of string elements to move). </font></p>

<p><font face="Arial" size="2">Unlike other instructions which operate on memory, the
string instructions are single-byte instructions which don't have any explicit operands.
The operands for the string instructions include </font>

<ul>
  <li><font face="Arial" size="2">the <code>si </code>(source index) register, </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the <code>di </code>(destination index) register, </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the <code>cx </code>(count) register, </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the <code>ax </code>register, and </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the direction flag in the FLAGS register. </font></li>
</ul>

<p><font face="Arial" size="2">For example, one variant of the <code>movs </code>(move
string) instruction copies a string from the source address specified by <code>ds:si </code>to
the destination address specified by <code>es:di</code>, of length <code>cx</code>.
Likewise, the <code>cmps </code>instruction compares the string pointed at by <code>ds:si</code>,
of length <code>cx</code>, to the string pointed at by <code>es:di</code>. </font></p>

<p><font face="Arial" size="2">Not all instructions have source and destination operands
(only <code>movs </code>and <code>cmps </code>support them). For example, the <code>scas </code>instruction
(scan a string) compares the value in the accumulator to values in memory. Despite their
differences, the 80x86's string instructions all have one thing in common - using them
requires that you deal with two segments, the data segment and the extra segment. </font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING1-23"></a>15.1.2 The REP/REPE/REPZ
and REPNZ/REPNE Prefixes</font></strong></p>

<p><font face="Arial" size="2">The string instructions, by themselves, do not operate on
strings of data. The <code>movs </code>instruction, for example, will move a single byte,
word, or double word. When executed by itself, the <code>movs </code>instruction ignores
the value in the <code>cx </code>register. The repeat prefixes tell the 80x86 to do a
multi-byte string operation. The syntax for the repeat prefix is:</font> </p>

<pre><font face="Courier New" size="2">Field:
Label   repeat  mnemonic operand        ;comment

For MOVS:
        rep     movs    {operands}

For CMPS:
        repe    cmps    {operands}      
        repz    cmps    {operands}
        repne   cmps    {operands}
        repnz   cmps    {operands}

For SCAS:
        repe    scas    {operands}
        repz    scas    {operands}
        repne   scas    {operands}
        repnz   scas    {operands}

For STOS:
        rep     stos    {operands}</font></pre>

<p><font face="Arial" size="2">You don't normally use the repeat prefixes with the <code>lods
</code>instruction. </font></p>

<p><font face="Arial" size="2">As you can see, the presence of the repeat prefixes
introduces a new field in the source line - the repeat prefix field. This field appears
only on source lines containing string instructions. In your source file: </font>

<ul>
  <li><font face="Arial" size="2">the label field should always begin in column one, </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the repeat field should begin at the first tab stop, and </font></li>
</ul>

<ul>
  <li><font face="Arial" size="2">the mnemonic field should begin at the second tab stop. </font></li>
</ul>

<p><font face="Arial" size="2">When specifying the repeat prefix before a string
instruction, the string instruction repeats <code>cx </code>times<a HREF="#FOOTNOTE-2">[2]</a>.
Without the repeat prefix, the instruction operates only on a single byte, word, or double
word. </font></p>

<p><font face="Arial" size="2">You can use repeat prefixes to process entire strings with
a single instruction. You can use the string instructions, without the repeat prefix, as
string primitive operations to synthesize more powerful string operations.</font></p>

<p><font face="Arial" size="2">The operand field is optional. If present, MASM simply uses
it to determine the size of the string to operate on. If the operand field is the name of
a byte variable, the string instruction operates on bytes. If the operand is a word
address, the instruction operates on words. Likewise for double words. If the operand
field is not present, you must append a &quot;B&quot;, &quot;W&quot;, or &quot;D&quot; to
the end of the string instruction to denote the size, e.g., <code>movsb</code>, <code>movsw</code>,
or <code>movsd</code>.</font></p>

<p><strong><font face="Arial" size="3"><a NAME="HEADING1-55"></a>15.1.3 The Direction Flag</font></strong></p>

<p><font face="Arial" size="2">Besides the <code>si, di, si</code>, and <code>ax </code>registers,
one other register controls the 80x86's string instructions - the flags register.
Specifically, the direction flag in the flags register controls how the CPU processes
strings. </font></p>

<p><font face="Arial" size="2">If the direction flag is clear, the CPU increments <code>si
</code>and <code>di </code>after operating upon each string element. For example, if the
direction flag is clear, then executing <code>movs </code>will move the byte, word, or
double word at <code>ds:si </code>to <code>es:di </code>and will increment <code>si </code>and
<code>di </code>by one, two, or four. When specifying the <code>rep </code>prefix before
this instruction, the CPU increments <code>si </code>and <code>di </code>for each element
in the string. At completion, the <code>si </code>and <code>di </code>registers will be
pointing at the first item beyond the string.</font></p>

<p><font face="Arial" size="2">If the direction flag is set, then the 80x86 decrements <code>si
</code>and <code>di </code>after processing each string element. After a repeated string
operation, the <code>si </code>and <code>di </code>registers will be pointing at the first
byte or word before the strings if the direction flag was set. </font></p>

<p><font face="Arial" size="2">The direction flag may be set or cleared using the <code>cld
</code>(clear direction flag) and <code>std </code>(set direction flag) instructions. When
using these instructions inside a procedure, keep in mind that they modify the machine
state. Therefore, you may need to save the direction flag during the execution of that
procedure. The following example exhibits the kinds of problems you might encounter: </font></p>

<pre><font face="Courier New" size="2">StringStuff:
                cld
        &lt;do some operations&gt;
                call    Str2
        &lt;do some string operations requiring D=0&gt;
                 .
                 .
                 .
Str2            proc    near
                std
        &lt;Do some string operations&gt;
                ret
Str2            endp</font></pre>

<p><font face="Arial" size="2">This code will not work properly. The calling code assumes
that the direction flag is clear after <code>Str2</code> returns. However, this isn't
true. Therefore, the string operations executed after the call to <code>Str2 </code>will
not function properly. </font></p>

<p><font face="Arial" size="2">There are a couple of ways to handle this problem. The
first, and probably the most obvious, is always to insert the <code>cld </code>or <code>std
</code>instructions immediately before executing a string instruction. The other
alternative is to save and restore the direction flag using the <code>pushf </code>and <code>popf
</code>instructions. Using these two techniques, the code above would look like this:</font></p>

<p><font face="Arial" size="2">Always issuing <code>cld </code>or <code>std </code>before
a string instruction: </font></p>

<pre><font face="Courier New" size="2">StringStuff:
                cld
        &lt;do some operations&gt;
                call    Str2
                cld
        &lt;do some string operations requiring D=0&gt;
                 .
                 .
                 .
Str2            proc    near
                std
        &lt;Do some string operations&gt;
                ret
Str2            endp</font></pre>

<p><font face="Arial" size="2">Saving and restoring the flags register: </font></p>

<pre><font face="Courier New" size="2">StringStuff:
                cld
        &lt;do some operations&gt;
                call    Str2
        &lt;do some string operations requiring D=0&gt;
                 .
                 .
                 .
Str2            proc    near
                pushf
                std
        &lt;Do some string operations&gt;
                popf
                ret
Str2            endp</font></pre>

<p><font face="Arial" size="2">If you use the <code>pushf </code>and <code>popf </code>instructions
to save and restore the flags register, keep in mind that you're saving and restoring all
the flags. Therefore, such subroutines cannot return any information in the flags. For
example, you will not be able to return an error condition in the carry flag if you use <code>pushf
</code>and <code>popf</code>.</font></p>

<hr noshade size="1" color="#000000">

<p><font face="Arial" size="2"><strong><a NAME="FOOTNOTE-1"></a>[1]</strong> The 80186 and
later processor support two additional string instructions, INS and OUTS which input
strings of data from an input port or output strings of data to an output port. We will
not consider these instructions in this chapter. </font></p>

<p><font face="Arial" size="2"><strong><a NAME="FOOTNOTE-2"></a>[2]</strong> Except for
the <code>cmps </code>instruction which repeats at most the number of times specified in
the <code>cx </code>register.</font></p>
<div align="center"><center>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%" valign="middle" align="center" nowrap bgcolor="#000000" height="1" colspan="3"></td>
  </tr>
  <tr>
    <td width="34%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="left"><a href="../Chapter_14/CH14-1.html"><img src="../images/WB00823_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a><font face="Arial" size="2"><strong> <a href="../Chapter_14/CH14-1.html">Chapter
    Fourteen</a></strong></font></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><a href="../toc.html"><font face="Arial" size="2"><strong>Table of Content</strong></font></a></td>
    <td width="33%" valign="middle" align="center" bgcolor="#FFFFFF" nowrap><p align="right"><font face="Arial" size="2"><strong><a href="CH15-2.html">Chapter Fifteen</a> (Part 2)&nbsp; </strong></font><a href="CH15-2.html"><img src="../images/WB00827_.GIF" align="absmiddle" border="0" WIDTH="12" HEIGHT="24"></a></td>
  </tr>
</table>
</center></div>

<p align="right"><font face="Arial" size="2"><strong>Chapter Fifteen: Strings And
Character Sets (Part 1)<br>
28 SEP 1996</strong></font></p>
</body>

<!-- Mirrored from www.arl.wustl.edu/~lockwood/class/cs306/books/artofasm/Chapter_15/CH15-1.html by HTTrack Website Copier/3.x [XR&CO'2008], Fri, 05 Dec 2008 15:27:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
