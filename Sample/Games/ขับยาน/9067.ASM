TITLE THIS IS PROJECT MR.PRAMOTE PHAIRATSAMEE CSS1DB 4940559067
.MODEL SMALL
.386
.STACK 100H

INCLUDE	MACRO.ASM

.DATA
;LOADBMP

	BMP_WIDTH	DW	?
	BMP_WIDTH2	DW	?     
	BMP_HEIGHT	DW	?
	BMP_BUFFER 	DB  1024 DUP(?)
        BMP_X           DW      ?              
	BMP_Y		DW	?
	BMP_Y2		DW	?
	TRANSPARENT	DB	01H
	BMP_MODE	DB	0

;============================================================================================
        ;IMMAGE PICTURE FOR GAME MAIN
;============================================================================================


	MENU		DB	'MENU.BMP',0
   BACKGROUND1          DB      'MAIN.BMP',0
   NULL			DB	'FIRENULL.BMP',0
   RED			DB	'RED.BMP',0
   YELLOW		DB	'YELLOW.BMP',0
   GREEN		DB	'GREEN.BMP',0
   MYCAR		DB	'MYCAR.BMP',0
   MYCARHIT		DB	'MYCARHIT.BMP',0
   SRUN1		DB	'SRUN1.BMP',0
   SRUN2		DB	'SRUN2.BMP',0
   CSKY			DB	'CSKY.BMP',0
   RUN			DB	'RUN.BMP',0
   STONE		DB	'STONE.BMP',0
   STONE2		DB	'STONE2.BMP',0
   STONE3		DB	'STONE3.BMP',0
   STONE4		DB	'STONE4.BMP',0
   STONE5		DB	'STONE5.BMP',0
   STONE6		DB	'STONE6.BMP',0
   
   CARA			DB	'CARA.BMP',0
   CARA2		DB	'CARA2.BMP',0
   CARA3		DB	'CARA3.BMP',0
   CARA4		DB	'CARA4.BMP',0
   CARA5		DB	'CARA5.BMP',0
  
   
   CARB5		DB	'CARB5.BMP',0
   CARB4		DB	'CARB4.BMP',0
   CARB3		DB	'CARB3.BMP',0
   CARB2		DB	'CARB2.BMP',0
   CARB			DB	'CARB.BMP',0
   
   CARAI2		DB	'CARAI2.BMP',0
   CAR_X		DW	?
   CAR_Y		DW	?
   OBJ_X1		DW	?
   OBJ_X2		DW	?
   
   ENERGY1		DB	'ENERGY1.BMP',0
   ENERGY2		DB	'ENERGY2.BMP',0
   ENERGY3		DB	'ENERGY3.BMP',0
   ENERGY4		DB	'ENERGY4.BMP',0
   
   FINISH1		DB	'FINISH1.BMP',0
   FINISH2		DB	'FINISH2.BMP',0
   FINISH3		DB	'FINISH3.BMP',0
   FINISH4		DB	'FINISH4.BMP',0
   FINISH5		DB	'FINISH5.BMP',0
   FINISH6		DB	'FINISH6.BMP',0
   FIRECAR		DB	'FIRECAR.BMP',0
   HISCORE		DB	'HISCORE.BMP',0
   OVER			DB	'OVER.BMP',0   
   REDY			DB	'REDY.BMP',0
   Y_REDY		DB	'Y_REDY.BMP',0
   X_REDY		DB	'X_REDY.BMP',0
   
   RAND_NUM		DW	?
   CRASH_COUNT          DB  0
   
   ;SCORE
	SCORE		DW	?
	NAME1		DB	10,0,10 DUP(0FFH)
	NAME2		DB      10 DUP(0),'$'
	NAME_REC        DB      11 DUP(10 DUP(0))
	SCORE_REC       DW      11 DUP(0)
	NUM             DW      0
	NUM2            DW      0
	FILESCORE       DB      'SCORE.BIN',0
   
;====================================================================================================


.CODE
	
	MAIN PROC
	
	MOV	AX,@DATA
	MOV	DS,AX
	MOV	ES,AX
	
        MOV     AH,0             ; CHOOSE FUNCTION MODE 
	MOV	AL,13H		 ;  MODE SCREEN 320*200 256 COLOR	
        INT     10H              ; DISPLAY GRAPHIC MODE 

        CALL    RANDOMIZE        ;GET TIME
TITLE_GAME:
	
	PASTEBMP	0,0,MENU
	CALL	GET_NAME
	
        MOV     CAR_X,100        ;DEFINE START POSITIONS
        MOV     CAR_Y,150        ;
        MOV     SCORE,0          ;GET SCORE = 0
        MOV     CRASH_COUNT,0    
	
        CALL    TRAFFIC_LIGHT    
	
        MOV     AX,0             ;INITIALIZE MOUSE
	INT	33H
	
;===========================================================================================;
         ;CAR RUN
;===========================================================================================;	

		MOV		DX,16			;DEFINE TIME OF FIRST START ACCIDENT ROAD
        MOV     CX,300          ;LOOP ROAD
	
ROAD_LOOP:

		CALL	NORM_ROAD
		
	DEC	DX			
	JNZ	UPDATE_SCORE				
	CALL	STONE_ROAD
	
	CALL	RANDOM
	MOV	DX,RAND_NUM
	AND	DX,0FH			;0-15
	INC	DX				;1-16
	
UPDATE_SCORE:

        ADD	SCORE,10
	MOV	AX,SCORE
	GOTOXY 6,2
	CALL	OUTDEC
	
	CMP	CRASH_COUNT,4	;CHECK GAME OVER
	JE	SHOW_SCORE
	
	LOOP	ROAD_LOOP		;ROAD 300 LOOP
	CALL	FINISH_CAR		;CALL FINISH

SHOW_SCORE:

        PASTEBMP	0,0,HISCORE
	CALL	GET_SCORE
	CALL	DISP_SCORE
	
	MOV	AH,00H				;WAIT KEY
	INT	16H
	
	CALL	GAME_REDY
        JMP     TITLE_GAME
	
	
	MAIN	ENDP

;===========================================================================
;
;       ;NORMAL ROAD
;
;===========================================================================

        NORM_ROAD	PROC
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	RET
        NORM_ROAD       ENDP
;===========================================================================

        TRAFFIC_LIGHT	PROC
	
	PASTEBMP	0,0,BACKGROUND1
	
	TPASTEBMP	110,150,225,MYCAR
	DELAY 1000
	PASTEBMP	101,0,NULL
	DELAY	1000
	PASTEBMP	0,0,CSKY
	
	
	PASTEBMP	101,3,NULL
	DELAY	1000
	PASTEBMP	0,0,CSKY
	
	
	PASTEBMP	101,6,NULL
	DELAY	1000
	PASTEBMP	0,0,CSKY
	
	
	PASTEBMP	101,9,NULL
	DELAY	1000
	PASTEBMP	0,0,CSKY

	
	PASTEBMP	101,12,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,15,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,18,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,21,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,24,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,27,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,30,NULL
	DELAY		1000
	PASTEBMP	0,0,CSKY
	
	PASTEBMP	101,33,NULL		
	
	DELAY 		15000
	PASTEBMP	101,33,RED
	DELAY 		20000
	PASTEBMP	101,33,YELLOW
	DELAY 		20000
	PASTEBMP	101,33,GREEN
	DELAY		5000
	PASTEBMP	0,100,SRUN1
	PASTEBMP	0,0,CSKY
	TPASTEBMP	110,150,225,MYCAR
	DELAY		500
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	110,150,225,MYCAR
	RET

        TRAFFIC_LIGHT   ENDP



;============================================================================
	
	UPDATE_CAR_POS	PROC
	PUSHA
	
	MOV	AX,03
	INT	33H				;INTERRUP MOUSE
	SHR	CX,1			;CX DIV 2
	CMP	CX,200
	JG	POS_LIMIT
	MOV	CAR_X,CX		;POSITION MOUSE TO POSITION CAR
	POPA
	RET
	
POS_LIMIT:

        MOV	CAR_X,200
	POPA
	RET
	
	UPDATE_CAR_POS	ENDP
;============================================================================
	
	STONE_ROAD	PROC

	PUSH	AX
	PUSH	BX
	PUSH	DX
	
	CALL	RANDOM
	XOR	DX,DX			;CLEAR DX 
	MOV	BX,6			;0-5
	MOV	AX,RAND_NUM		
	DIV	BX
	
	OR	DX,DX
	JNZ	STONE_RIGHT
	
STONE_LEFT:											 ;ACCIDENT STONE LEFT

        PASTEBMP	0,100,RUN
	TPASTEBMP	119,101,18,STONE
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	108,110,18,STONE
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	103,114,18,STONE2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	95,119,18,STONE2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	87,124,18,STONE3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	79,130,18,STONE3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	70,136,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	62,144,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	49,154,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	;CHECK_CRASH	35,137
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	35,164,18,STONE6
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	CHECK_CRASH	26,128
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	26,174,18,STONE6
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	JMP	RET_STONE_ROAD

STONE_RIGHT:												;ACCIDENT STONE RIGHT

	CMP	DX,1
	JNE	CARA_LEFT

	PASTEBMP	0,100,RUN
	TPASTEBMP	175,101,18,STONE
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,108,18,STONE
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	176,114,18,STONE2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	184,119,18,STONE2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	177,125,18,STONE3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,131,18,STONE3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	178,137,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	187,144,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	180,154,18,STONE4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	193,160,18,STONE6
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	CHECK_CRASH	187,289
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	187,174,18,STONE6
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	
	JMP	RET_STONE_ROAD
	
CARA_LEFT:											;ACCIDENT CAR A LEFT
	CMP	DX,2
	JNE	CARA_RIGHT
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	119,101,18,CARA
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	108,110,18,CARA
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	103,114,18,CARA2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	95,119,18,CARA2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	87,124,18,CARA3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	79,130,18,CARA3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	70,136,18,CARA4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	62,144,18,CARA4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	49,154,18,CARA5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	

        CHECK_CRASH	40,107
	

        PASTEBMP	0,100,SRUN2
	TPASTEBMP	40,160,18,CARA5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
        DELAY_ROAD      1000
	
	
	JMP	RET_STONE_ROAD

	
CARA_RIGHT:														;ACCIDENT CAR A RIGHT
	CMP	DX,3
	JNE	CARB_LEFT
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	175,101,18,CARA
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,108,18,CARA
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	176,114,18,CARA2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	184,119,18,CARA2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	177,125,18,CARA3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,131,18,CARA3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	178,137,18,CARA4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	187,144,18,CARA4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	;CHECK_CRASH	190,257
	
	PASTEBMP	0,1000,RUN
	TPASTEBMP	190,154,18,CARA5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	CHECK_CRASH	198,265
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	198,160,18,CARA5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	

        JMP     RET_STONE_ROAD
	

	
CARB_LEFT:													;ACCIDENT CAR B LEFT

        CMP	DX,4
	JNE	CARB_RIGHT
	
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	119,101,18,CARB
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	108,110,18,CARB
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	103,114,18,CARB2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	95,119,18,CARB2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	87,124,18,CARB3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	79,130,18,CARB5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	70,136,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	62,144,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	49,154,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	CHECK_CRASH	40,118
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	40,160,18,CARB5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	
	
	JMP	RET_STONE_ROAD

	

CARB_RIGHT:												;ACCIDENT  CAR B RIGHT

	PASTEBMP	0,100,RUN
	TPASTEBMP	175,101,18,CARB
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,108,18,CARB
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	1000

	PASTEBMP	0,100,RUN
	TPASTEBMP	176,114,18,CARB2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	184,119,18,CARB2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	177,125,18,CARB3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	185,131,18,CARB3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	178,137,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	187,144,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	;CHECK_CRASH	180,258
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	180,154,18,CARB4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	CHECK_CRASH	198,276
		
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	198,160,18,CARB5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
RET_STONE_ROAD:

        POP	DX
	POP	BX
	POP	AX
	RET
	
	STONE_ROAD	ENDP

;===========================================================================

                       ;CHECK CRASH CAR
;===========================================================================	
	CHK_CRASH	PROC
	PUSH	AX


CHK_CAR_X1_G:

        MOV	AX,CAR_X
	CMP	AX,OBJ_X2
	JLE	CHK_CAR_X2_L
	JMP	CHK_CRASH_RET
	
CHK_CAR_X2_L:

        ADD	AX,86
	CMP	AX,OBJ_X1
	JGE	CAR_CRASH
	JMP	CHK_CRASH_RET
		
CAR_CRASH:

        INC	CRASH_COUNT
	
ENER1:
	CMP	CRASH_COUNT,1
	JNE	ENER2	
	PASTEBMP	4,31,ENERGY1
        CALL	BEEP

	JMP	CHK_CRASH_RET	
	
ENER2:	
	CMP	CRASH_COUNT,2
	JNE	ENER3
	PASTEBMP	4,31,ENERGY2
        CALL    BEEP

	JMP	CHK_CRASH_RET	

ENER3:
	CMP	CRASH_COUNT,3
	JNE	ENER4
	PASTEBMP	4,31,ENERGY3
	CALL	BEEP

	JMP	CHK_CRASH_RET	
	
ENER4:
	
	PASTEBMP	4,31,ENERGY4
        TPASTEBMP    80,33,225,OVER
        CALL BEEP
	MOV	AH,00H
	INT	16H
	
CHK_CRASH_RET:

        POP	AX
	RET

	CHK_CRASH	ENDP

;=============================================================================
	
	DELAY2	PROC
	
	PUSH AX
	PUSH BX

	MOV	BX,250

EATTIME1:

        MOV AX,200
	
EATTIME2:

        DEC	AX
	JNZ	EATTIME2
	
	DEC	BX
	JNZ EATTIME1
	
	POP BX
	POP AX
	
	RET
	DELAY2	ENDP
	
;=======================================================================================
;
;SET RAND_NUM FROM TIME MILISECOND FOR RANDOMIZE IN FIRST TIME START PROGRAM
;
;=======================================================================================
RANDOMIZE	PROC
      
        MOV     AH,2CH          ;GET TIME
	INT	21H
	MOV	RAND_NUM,DX
        RET


RANDOMIZE	ENDP
	
;=================================================================================
;random numbers that are uniformly distributed between 0 and 65535
;SOUREC FROM WEBSITE
;=================================================================================


RANDOM	PROC
	PUSH	BX
	PUSH	DX
	
        MOV     DX,RAND_NUM
	MOV     BX,DX
        SHL     DX,2
        ADD     DX,BX
        XCHG    DL,DH
        MOV     RAND_NUM,DX     ;0-65535 IN DX
	
	POP		DX
	POP		BX
	RET
RANDOM	ENDP
	
OUTDEC PROC
;prints AX as a unsigned decimal integer
;input: AX
;output : none
	
	PUSH	AX
	PUSH	BX
	PUSH	CX
	PUSH	DX

	;OR	AX,AX		;FOR SIGN VALUE
	;JGE	@END_IF1

	;PUSH	AX
	;MOV	DL,'-'	
	;MOV	AH,2
	;INT	21H
	;POP	AX
	;NEG	AX

@END_IF1:
	XOR	CX,CX
	MOV	BX,10D

@REPEAT1:
	XOR	DX,DX
	DIV	BX
	PUSH	DX
	INC	CX
	OR	AX,AX
	JNE	@REPEAT1

	;MOV	AH,2

@PRINT_LOOP:
	POP	DX
	OR	DL,30H
	;INT	21H
	WRITE_CHAR	DL,10
	LOOP	@PRINT_LOOP

	POP	DX
	POP	CX
	POP	BX
	POP	AX
	
	RET
	
OUTDEC	ENDP

FINISH_CAR	PROC

	
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	100,105,2,FINISH1
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	100,105,2,FINISH1
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	81,117,2,FINISH2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	81,117,2,FINISH2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
		
	DELAY_ROAD	2000

	PASTEBMP	0,100,RUN
	TPASTEBMP	55,130,2,FINISH3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	55,130,2,FINISH3
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	34,147,7,FINISH4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	34,147,7,FINISH4
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	2000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	4,164,7,FINISH5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	4,164,7,FINISH5
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,RUN
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	0,100,SRUN2
	TPASTEBMP	CAR_X,CAR_Y,225,MYCAR
	
	DELAY_ROAD	1000
	
	PASTEBMP	101,33,FINISH6
	MOV	AH,01
	INT	21H

	

RET
FINISH_CAR	ENDP
	
;===================================================================================;
                 ;GAME REDY
;====================================================================================;

GAME_REDY	PROC

	PUSH AX
        
	PASTEBMP 0,0,REDY
	MOV	BL,2						
	
CHECK_KEY:

        XOR	AX,AX
	MOV	AH,08H					;READ KEYBOARD NOT  DISPLAY
	INT	21H
	
CHECK_Y:
	CMP	AL,'Y'
	JNE	CHECK_N
	PASTEBMP 0,0,Y_REDY
	MOV	BL,1
	JMP	CHECK_KEY

CHECK_N:
	CMP	AL,'N'
	JNE	CHECK_ENTER
	PASTEBMP 0,0,X_REDY
	MOV	BL,0
	JMP	CHECK_KEY
	
CHECK_ENTER:
	CMP	AL,0DH
	JNE CHECK_KEY
	CMP	BL,1
	JE	PLAY_AGAIN
	CMP	BL,0
	JNE	CHECK_KEY
	CALL	EXIT
	
PLAY_AGAIN:
	
    POP AX
    RET
       
GAME_REDY	ENDP


BEEP	PROC

	MOV	DL,07H		;ASCII SOUND BEEP
	MOV	AH,02H
	INT	21H
	RET

BEEP	ENDP
	
;=====================================================================================================

EXIT	PROC

	MOV	AX,03H
	INT	10H			;SET TO TEXT MODE

	MOV	AH,4CH
	INT	21H			;RETURN TO DOS

RET
EXIT	ENDP



INCLUDE	LOADBMP.ASM
INCLUDE	POS.ASM
INCLUDE	HIGHSCORE.ASM
	
END	MAIN
	

	
	
	
	
	
